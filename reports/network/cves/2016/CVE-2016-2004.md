---
cve_id: CVE-2016-2004
template_path: nuclei-templates/network/cves/2016/CVE-2016-2004.yaml
affected_product: HP Data Protector
severity: critical
authentication: none
external_callback: false
affected_versions: HPE Data Protector before 7.03_108, 8.x before 8.15, and 9.x before 9.06
preconditions: []
poc_classification: rce
---

## Vulnerability
HP Data Protector is affected by an arbitrary command execution vulnerability (CVE-2016-2004, CWE-306) due to missing authentication on critical functions. This is an incomplete fix for CVE-2014-2623. 

HPE Data Protector before 7.03_108, 8.x before 8.15, and 9.x before 9.06 allow remote attackers to execute arbitrary code via unspecified vectors related to lack of authentication. 

Successful exploitation allows an attacker to execute arbitrary commands with the privileges of the Data Protector service account. 

CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (score 9.8). 

Remediation: Upgrade to the most recent version of HP Data Protector.

## PoC / Detection
Classification: rce

The template establishes a TCP connection to the target and sends a hex-encoded payload that executes `perl.exe -esystem('whoami')`. It matches the hex-encoded response for the string indicating execution as `NT AUTHORITY\SYSTEM`, confirming the unauthenticated RCE condition.

## References
- https://www.exploit-db.com/exploits/39858
- https://nvd.nist.gov/vuln/detail/CVE-2016-2004
- http://www.kb.cert.org/vuls/id/267328
- https://www.exploit-db.com/exploits/39858/
- http://packetstormsecurity.com/files/137199/HP-Data-Protector-A.09.00-Command-Execution.html
