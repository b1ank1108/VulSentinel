---
cve_id: CVE-2020-11981
template_path: nuclei-templates/network/cves/2020/CVE-2020-11981.yaml
affected_product: Apache Airflow
severity: critical
authentication: none
external_callback: true
affected_versions: <=1.10.10
preconditions: Using CeleryExecutor with directly accessible Redis or RabbitMQ broker
poc_classification: rce
---

## Vulnerability
Apache Airflow <=1.10.10 is affected by a command injection vulnerability (CWE-78). When using CeleryExecutor, an attacker who can connect directly to the message broker (Redis or RabbitMQ) can inject malicious tasks into the queue, causing the Celery worker to execute arbitrary commands on the target system.  
Impact: full remote code execution (CVSS 3.1 score 9.8 Critical, AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H).  
Remediation: upgrade to version 1.10.11 or higher.

## PoC / Detection
Classification: rce

The template opens a TCP connection to the Redis broker (typically port 6379) and issues a Redis-protocol LPUSH command to the "default" queue. The payload contains a serialized Celery task definition for `airflow.executors.celery_executor.execute_command` with a base64-encoded command that runs `curl http://{{interactsh-url}}`. Detection is confirmed when the Celery worker processes the task and generates an out-of-band HTTP callback containing the `User-Agent: curl` header.

## References
- https://github.com/apache/airflow/pull/9178
- https://github.com/vulhub/vulhub/tree/master/airflow/CVE-2020-11981
- https://lists.apache.org/thread.html/r7255cf0be3566f23a768e2a04b40fb09e52fcd1872695428ba9afe91%40%3Cusers.airflow.apache.org%3E
- https://github.com/t0m4too/t0m4to
- https://github.com/ARPSyndicate/cvemon
