---
cve_id: CVE-2021-21307
template_path: nuclei-templates/http/cves/2021/CVE-2021-21307.yaml
affected_product: Lucee Admin
severity: critical
authentication: none
external_callback: false
affected_versions: before versions 5.3.7.47, 5.3.6.68 or 5.3.5.96
preconditions: Lucee Administrator interface publicly accessible
poc_classification: rce
---

## Vulnerability
Unauthenticated remote code execution in Lucee Admin (imgProcess.cfm) via path traversal, allowing attackers to write arbitrary CFML files to the context directory and execute system commands.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (9.8). CWE-862 (Missing Authorization). Impact includes full system compromise via arbitrary code execution.

## PoC / Detection
Classification: rce

The template executes a 3-step detection:
1. Initial POST to `/lucee/admin/imgProcess.cfm?file=/whatever`
2. Path traversal POST to `/lucee/admin/imgProcess.cfm?file=/../../../context/{{randstr}}.cfm` to write a malicious `.cfm` webshell containing `<cfexecute>` for command execution.
3. POST to the uploaded `/lucee/{{randstr}}.cfm` with `cmd=id`, matching for `"uid="`, `"gid="`, `"groups="` in the 200 OK response.

This verifies exploitable RCE by deploying and invoking a command execution shell.

## References
- https://github.com/lucee/Lucee/security/advisories/GHSA-2xvv-723c-8p7r
- https://github.com/httpvoid/writeups/blob/main/Apple-RCE.md
- https://nvd.nist.gov/vuln/detail/CVE-2021-21307
- http://ciacfug.org/blog/updating-lucee-as-part-of-a-vulnerability-alert-response
- https://dev.lucee.org/t/lucee-vulnerability-alert-november-2020/7643
