---
cve_id: CVE-2021-25646
template_path: nuclei-templates/http/cves/2021/CVE-2021-25646.yaml
affected_product: Apache Druid
severity: high
authentication: none
external_callback: false
affected_versions: unknown
preconditions: default configuration lacking authorization and authentication
poc_classification: rce
---

## Vulnerability
Apache Druid is susceptible to remote code execution because by default it lacks authorization and authentication. Attackers can send specially crafted requests to execute arbitrary code with the privileges of processes on the Druid server.

**Impact:** Successful exploitation of this vulnerability could allow an attacker to execute arbitrary code on the affected system.

**Remediation:** Apply the latest security patches or upgrade to a patched version of Apache Druid.

**CVSS:** 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)  
**CWE:** CWE-732

## PoC / Detection
Classification: rce

The template sends a single POST request to `/druid/indexer/v1/sampler` with a crafted JSON payload. The payload defines an "index" task using a local firehose (reading `/etc/passwd`) and a "javascript" parseSpec whose function invokes `java.lang.Runtime.getRuntime().exec("/bin/sh -c cat /etc/passwd")` to run shell commands and return output in the response. Detection succeeds if the server returns HTTP 200, `application/json` Content-Type, sampler metrics (`numRowsRead`, `numRowsIndexed`), and a regex match for the root user entry (`root:.*:0:0:`) in the body.

## References
- https://paper.seebug.org/1476/
- https://lists.apache.org/thread.html/rfda8a3aa6ac06a80c5cbfdeae0fc85f88a5984e32ea05e6dda46f866%40%3Cdev.druid.apache.org%3E
- http://www.openwall.com/lists/oss-security/2021/01/29/6
- https://lists.apache.org/thread.html/r64431c2b97209f566b5dff92415e7afba0ed3bfab4695ebaa8a62e5d@%3Cdev.druid.apache.org%3E
- https://nvd.nist.gov/vuln/detail/CVE-2021-25864
