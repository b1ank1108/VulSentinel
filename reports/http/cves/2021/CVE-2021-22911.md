---
cve_id: CVE-2021-22911
template_path: nuclei-templates/http/cves/2021/CVE-2021-22911.yaml
affected_product: Rocket.Chat
severity: critical
authentication: none
external_callback: false
affected_versions: <=3.13
preconditions: []
poc_classification: state-change
---

## Vulnerability
NoSQL injection in Rocket.Chat <=3.13 (specifically versions 3.11, 3.12, and 3.13) via the unauthenticated `/api/v1/method.callAnon/getPasswordPolicy` endpoint. Attacker-supplied input reaches MongoDB queries without sanitization, enabling arbitrary NoSQL query execution. This can result in extraction of sensitive database records, modification of data, unauthorized administrative operations, or denial of service. CVSS 9.8 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H).

## PoC / Detection
Classification: state-change

The template issues one raw POST request to `/api/v1/method.callAnon/getPasswordPolicy` containing the JSON payload `{"message": "{\"msg\":\"method\", \"method\": \"getPasswordPolicy\", \"params\": [{\"token\": {\"$regex\": \"^{{randstr}}\"}}] }"}`. Vulnerability is confirmed if the server replies with HTTP 200, `Content-Type: application/json` header, and response body simultaneously containing the strings `[error-invalid-user]` and `"success":true`.

## References
- http://packetstormsecurity.com/files/162997/Rocket.Chat-3.12.1-NoSQL-Injection-Code-Execution.html
- https://github.com/vulhub/vulhub/tree/master/rocketchat/CVE-2021-22911
- https://hackerone.com/reports/1130721
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-22911
- https://blog.sonarsource.com/nosql-injections-in-rocket-chat
- https://nvd.nist.gov/vuln/detail/CVE-2021-22911
