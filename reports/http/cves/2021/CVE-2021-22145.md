---
cve_id: CVE-2021-22145
template_path: nuclei-templates/http/cves/2021/CVE-2021-22145.yaml
affected_product: Elasticsearch
severity: medium
authentication: none
external_callback: false
affected_versions: 7.10.0-7.13.3
preconditions: [ability to submit arbitrary queries to the _bulk endpoint]
poc_classification: info-leak
---

## Vulnerability
Elasticsearch 7.10.0-7.13.3 is susceptible to information disclosure (CVE-2021-22145, CWE-209). A user able to submit arbitrary queries can craft a malformed query that triggers an error message containing previously used portions of a data buffer. The leaked buffer may include Elasticsearch documents or authentication details, enabling further data exfiltration, modification, or unauthorized operations.  
CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N (6.5).  
Impact: unauthorized access to sensitive information.  
Remediation: upgrade to a fixed version.

## PoC / Detection
Classification: info-leak

The template performs a single unauthenticated POST request to `{{BaseURL}}/_bulk` using body content `@` and `Content-Type: application/json` header. Detection succeeds if the response returns HTTP 400 status and the body simultaneously contains the words `root_cause`, `truncated`, and `reason`.

## References
- https://github.com/jaeles-project/jaeles-signatures/blob/e9595197c80521d64e31b846808095dd07c407e9/cves/elasctic-memory-leak-cve-2021-22145.yaml
- https://packetstormsecurity.com/files/163648/ElasticSearch-7.13.3-Memory-Disclosure.html
- https://discuss.elastic.co/t/elasticsearch-7-13-4-security-update/279177
- https://nvd.nist.gov/vuln/detail/CVE-2021-22145
- https://security.netapp.com/advisory/ntap-20210827-0006/
