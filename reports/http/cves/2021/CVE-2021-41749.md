---
cve_id: CVE-2021-41749
template_path: nuclei-templates/http/cves/2021/CVE-2021-41749.yaml
affected_product: CraftCMS SEOmatic
severity: critical
authentication: none
external_callback: false
affected_versions: <= 3.4.11
preconditions: []
poc_classification: rce
---

## Vulnerability
In the SEOmatic plugin up to 3.4.11 for Craft CMS 3, unauthenticated attackers can perform Server-Side Template Injection (SSTI) via the X-Forwarded-Host header. This enables execution of arbitrary Twig templates and system commands, resulting in remote code execution and complete server compromise.  
CVSS: 9.8 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)  
CWE: 94  
Remediation: Upgrade to SEOmatic version 3.4.12 or later.

## PoC / Detection
Classification: rce  
The template sends two sequential raw GET requests to `/` with malicious `X-Forwarded-Host` headers containing SSTI payloads.  
First request injects a random marker plus arithmetic expression `{{num1}}*{{num2}}` to test template evaluation, matching the computed product in the response body.  
Second request injects `{{['cat /etc/passwd']|filter('system')}}` to trigger system command execution, matching `root:.*:0:0:` pattern in the response.  
Additional matchers require Craft CMS/SEOmatic indicators in the body, HTTP 200 status, stop-at-first-match, and up to 2 redirects.

## References
- https://github.com/nystudio107/craft-seomatic/commit/3fee7d50147cdf3f999cfc1e04cbc3fb3d9f2f7d
- https://nvd.nist.gov/vuln/detail/CVE-2021-41749
- https://github.com/nystudio107/craft-seomatic/blob/develop/CHANGELOG.md
