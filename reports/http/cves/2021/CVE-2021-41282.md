---
cve_id: CVE-2021-41282
template_path: nuclei-templates/http/cves/2021/CVE-2021-41282.yaml
affected_product: pfSense
severity: high
authentication: required
external_callback: false
affected_versions: 2.5.2
preconditions: []
poc_classification: rce
---

## Vulnerability
pfSense 2.5.2 contains an arbitrary file write vulnerability in `diag_routes.php`. The page executes `netstat` and parses its output with `sed`. Although `escapeshellarg` is used, sed-specific injection remains possible through the `filter` parameter, enabling authenticated attackers to write arbitrary content to arbitrary filesystem locations.

CVSS 3.1: 8.8 (AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H). CWE-74. Successful exploitation leads to unauthorized modification of critical system files and complete firewall compromise.

## PoC / Detection
Classification: rce

The template first performs a full login flow (GET `/index.php` followed by POST `/index.php` with credentials and extracted CSRF token), then issues a crafted GET `/diag_routes.php?isAjax=1&filter=.*/!d;};s/Destination/\x3c\x3fphp+var_dump(md5(\x27CVE-2021-41282\x27));unlink(__FILE__)\x3b\x3f\x3e/;w+/usr/local/www/test.php%0a%23` that injects sed commands to write a temporary PHP webshell to the web root. It finally GETs `/test.php` and confirms the MD5 hash `c3959e8a43f1b39b0d1255961685a238` appears in the 200 OK response body.

## References
- https://www.shielder.it/advisories/pfsense-remote-command-execution/
- https://www.rapid7.com/db/modules/exploit/unix/http/pfsense_diag_routes_webshell/
- https://docs.netgate.com/downloads/pfSense-SA-22_02.webgui.asc
- https://nvd.nist.gov/vuln/detail/CVE-2021-41282
- https://docs.netgate.com/pfsense/en/latest/releases/22-01_2-6-0.html
