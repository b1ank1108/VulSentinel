---
cve_id: CVE-2021-21985
template_path: nuclei-templates/http/cves/2021/CVE-2021-21985.yaml
affected_product: VMware vSphere Client (HTML5)
severity: critical
authentication: none
external_callback: false
affected_versions: unknown
preconditions: Virtual SAN Health Check plug-in enabled by default in vCenter Server
poc_classification: rce
---

## Vulnerability
VMware vSphere Client (HTML5) contains a remote code execution vulnerability due to lack of input validation in the Virtual SAN Health Check plug-in (enabled by default in vCenter Server). An unauthenticated remote attacker with network access to TCP/443 can execute arbitrary commands with unrestricted privileges on the underlying OS hosting vCenter Server.  
CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (score 9.8) | CWE-20 | Impact: arbitrary code execution as root.

## PoC / Detection
Classification: rce  
The template sends one raw unauthenticated POST request to `/ui/h5-vsan/rest/proxy/service/com.vmware.vsan.client.services.capability.VsanCapabilityProvider/getClusterCapabilityData` carrying the JSON body `{"methodInput":[{"type":"ClusterComputeResource","value": null,"serverGuid": null}]}`. It detects the vulnerable component by matching the exact string `{"result":{"isDisconnected":` in the response body, confirming the plug-in endpoint is exposed and responsive.

## References
- https://www.vmware.com/security/advisories/VMSA-2021-0010.html
- https://github.com/alt3kx/CVE-2021-21985_PoC
- https://nvd.nist.gov/vuln/detail/CVE-2021-21985
- http://packetstormsecurity.com/files/162812/VMware-Security-Advisory-2021-0010.html
- https://github.com/onSec-fr/CVE-2021-21985-Checker
