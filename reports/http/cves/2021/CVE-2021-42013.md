---
cve_id: CVE-2021-42013
template_path: nuclei-templates/http/cves/2021/CVE-2021-42013.yaml
affected_product: Apache 2.4.49/2.4.50
severity: critical
authentication: none
external_callback: false
affected_versions: 2.4.49 and 2.4.50
preconditions: mod_cgi enabled (for RCE); files outside document root not protected by "require all denied"
poc_classification: rce
---

## Vulnerability
Apache 2.4.49/2.4.50 contain a path-traversal flaw (CWE-22) in URL path normalization, an incomplete fix for CVE-2021-41773. An attacker can craft requests that map URLs to files outside the document root; if those files lack "require all denied" protection, the requests succeed, disclosing source code of interpreted files (e.g. CGI scripts). When mod_cgi is enabled, this escalates to remote code execution. CVSS 3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H = 9.8. Impact includes arbitrary code execution and sensitive data disclosure. Remediation: upgrade to 2.4.51 or later.

## PoC / Detection
Classification: rce

The template detects the flaw with three raw HTTP requests using double-encoded "../" sequences (%%32%65%%32%65):
- GET /icons/%%32%65%%32%65/.../etc/passwd and GET /icons/.%%32%65/.%%32%65/.../etc/passwd (LFI probe).
- POST /cgi-bin/%%32%65%%32%65/.../bin/sh with body `echo Content-Type: text/plain; echo; echo 31024-1202-EVC | rev` (RCE probe that outputs "CVE-2021-42013" on successful shell execution).

Matchers (OR condition, stop-at-first-match) look for regex "root:.*:0:0:" (LFI success) or word "CVE-2021-42013" (RCE success). `unsafe: true` and `max-request: 3`.

## References
- https://httpd.apache.org/security/vulnerabilities_24.html
- https://github.com/apache/httpd/commit/5c385f2b6c8352e2ca0665e66af022d6e936db6d
- https://nvd.nist.gov/vuln/detail/CVE-2021-42013
- https://twitter.com/itsecurityco/status/1446136957117943815
- http://jvn.jp/en/jp/JVN51106450/index.html
