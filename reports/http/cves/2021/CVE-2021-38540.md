---
cve_id: CVE-2021-38540
template_path: nuclei-templates/http/cves/2021/CVE-2021-38540.yaml
affected_product: Apache Airflow
severity: critical
authentication: none
external_callback: false
affected_versions: >=2.0.0 and <2.1.3
preconditions: []
poc_classification: state-change
---

## Vulnerability
Apache Airflow versions >=2.0.0 and <2.1.3 fail to protect the variable import endpoint (`/variable/varimport`). Unauthenticated users can add or modify Airflow variables used in DAGs, resulting in denial of service, information disclosure, or remote code execution (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H score 9.8; CWE-306, CWE-269).

## PoC / Detection
Classification: state-change

The template verifies the flaw by performing the unauthenticated import:  
- GET `/login/` (public page) to extract CSRF token via regex.  
- POST `/variable/varimport` as multipart/form-data containing a JSON file `{"type": "{{randstr}}"}`.  
Matchers confirm success with HTTP 302, `session=.` in response headers, and redirect body text "You should be redirected automatically to target URL: <a href="/">".

## References
- https://nvd.nist.gov/vuln/detail/CVE-2021-38540
- https://lists.apache.org/thread.html/rb34c3dd1a815456355217eef34060789f771b6f77c3a3dec77de2064%40%3Cusers.airflow.apache.org%3E
- https://lists.apache.org/thread.html/rac2ed9118f64733e47b4f1e82ddc8c8020774698f13328ca742b03a2@%3Cannounce.apache.org%3E
- https://lists.apache.org/thread.html/rac2ed9118f64733e47b4f1e82ddc8c8020774698f13328ca742b03a2%40%3Cannounce.apache.org%3E
- https://github.com/WhooAmii/POC_to_review
