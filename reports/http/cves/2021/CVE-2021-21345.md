---
cve_id: CVE-2021-21345
template_path: nuclei-templates/http/cves/2021/CVE-2021-21345.yaml
affected_product: XStream
severity: critical
authentication: none
external_callback: true
affected_versions: < 1.4.16
preconditions: [sufficient rights to manipulate the processed input stream]
poc_classification: rce
---

## Vulnerability
XStream versions before 1.4.16 suffer from a remote code execution vulnerability via insecure deserialization of untrusted XML input. An attacker who has sufficient rights can execute host commands by manipulating the processed input stream. This can lead to obtaining sensitive information, data modification, and unauthorized administrative operations.

Successful exploitation allows arbitrary code execution on the target system.

Remediation: Upgrade to XStream 1.4.16 or later, which addresses the default blacklist in the Security Framework.

CVSS 3.1 score: 9.9 (AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H), CWE-78, CWE-502.

## PoC / Detection
Classification: rce

The template issues a POST request to `/` containing a custom XML payload exploiting an XStream gadget chain (PriorityQueue with DataTransferer$IndexOrderComparator and ServerTableEntry) to trigger execution of the command `curl http://{{interactsh-url}}`. Confirmation occurs by detecting the resulting HTTP OOB interaction with "User-Agent: curl" in the interactsh request.

## References
- https://x-stream.github.io/CVE-2021-21345.html
- http://x-stream.github.io/changes.html#1.4.16
- https://github.com/x-stream/xstream/security/advisories/GHSA-hwpc-8xqv-jvj4
- https://nvd.nist.gov/vuln/detail/CVE-2021-21345
- https://lists.apache.org/thread.html/r8244fd0831db894d5e89911ded9c72196d395a90ae655414d23ed0dd@%3Cusers.activemq.apache.org%3E
