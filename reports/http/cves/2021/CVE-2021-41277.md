---
cve_id: CVE-2021-41277
template_path: nuclei-templates/http/cves/2021/CVE-2021-41277.yaml
affected_product: Metabase
severity: high
authentication: none
external_callback: false
affected_versions: prior to 0.40.5
preconditions: []
poc_classification: info-leak
---

## Vulnerability
Metabase is an open source data analytics platform. In affected versions a local file inclusion security issue has been discovered with the custom GeoJSON map (`admin->settings->maps->custom maps->add a map`) support and potential local file inclusion (including environment variables). URLs were not validated prior to being loaded.

**Impact**: The vulnerability can result in unauthorized access to sensitive files or execution of arbitrary code on the affected system.

**Remediation**: This issue is fixed in 0.40.5 and higher. If you are unable to upgrade immediately, you can mitigate this by including rules in your reverse proxy or load balancer or WAF to provide a validation filter before the application.

**CVSS**: 7.5 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N)  
**CWE**: CWE-22, CWE-200

## PoC / Detection
Classification: info-leak

The template detects the vulnerability by issuing unauthenticated GET requests to `{{BaseURL}}/api/geojson?url=file:///etc/passwd` (Linux) and `{{BaseURL}}/api/geojson?url=file:///c://windows/win.ini` (Windows) with `stop-at-first-match: true`. It matches on response body using regex `root:.*:0:0` for `/etc/passwd` or AND word match on `win.ini` strings ("bit app support", "fonts", "extensions").

## References
- https://github.com/metabase/metabase/security/advisories/GHSA-w73v-6p7p-fpfr
- https://nvd.nist.gov/vuln/detail/CVE-2021-41277
- https://twitter.com/90security/status/1461923313819832324
- https://github.com/metabase/metabase/commit/042a36e49574c749f944e19cf80360fd3dc322f0
- https://github.com/pen4uin/vulnerability-research-list
