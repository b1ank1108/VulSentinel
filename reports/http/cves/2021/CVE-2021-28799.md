---
cve_id: CVE-2021-28799
template_path: nuclei-templates/http/cves/2021/CVE-2021-28799.yaml
affected_product: QNAP HBS 3
severity: critical
authentication: none
external_callback: false
affected_versions: versions prior to v16.0.0415 on QTS 4.5.2; versions prior to v3.0.210412 on QTS 4.3.6; versions prior to v3.0.210411 on QTS 4.3.4; versions prior to v3.0.210411 on QTS 4.3.3; versions prior to v16.0.0419 on QuTS hero h4.5.1; versions prior to v16.0.0419 on QuTScloud c4.5.1~c4.5.4
preconditions: []
poc_classification: rce
---

## Vulnerability
QNAP HBS 3 (Hybrid Backup Sync) on QNAP NAS contains an improper authorization flaw (CWE-285, CVSS 3.1 9.8) allowing unauthenticated remote attackers to bypass access controls on the management CGI endpoint. Successful exploitation permits arbitrary command execution, leading to login without credentials, full system compromise, or unauthorized data access. The issue is isolated to HBS 3 (does not affect HBS 2 or 1.3) and specific QTS/QuTS hero/QuTScloud builds listed in affected versions. Remediation requires upgrading to the patched releases specified in the vendor advisory.

## PoC / Detection
Classification: rce

The template issues one unauthenticated raw POST request to `/cgi-bin/backup/hbs_mgnt.cgi` containing the JSON payload `{"act":"run_cmd","sid":"jisoosocoolhbsmgnt","cmd":"cat /etc/passwd"}`. Detection succeeds on HTTP 200 responses with `application/json` Content-Type whose body simultaneously matches three regex/keyword conditions confirming command output: the `admin:.*:0:0:` pattern from `/etc/passwd`, plus the JSON fields `"cgi_log":` and `"result":`.

## References
- https://www.qnap.com/en/security-advisory/QSA-21-13
- https://unit42.paloaltonetworks.com/ech0raix-ransomware-soho/
- https://gist.github.com/daniruiz/962ecca527b59954e619c5ae2cab680c
- https://nvd.nist.gov/vuln/detail/CVE-2021-28799
