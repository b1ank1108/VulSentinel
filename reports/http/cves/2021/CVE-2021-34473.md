---
cve_id: CVE-2021-34473
template_path: nuclei-templates/http/cves/2021/CVE-2021-34473.yaml
affected_product: Exchange Server
severity: critical
authentication: none
external_callback: false
affected_versions: unknown
preconditions: []
poc_classification: rce
---

## Vulnerability
Microsoft Exchange Server is vulnerable to a remote code execution vulnerability. This CVE ID is unique from CVE-2021-31196, CVE-2021-31206.

Successful exploitation of this vulnerability could allow an attacker to execute arbitrary code on the affected Exchange Server, potentially leading to a complete compromise of the system.

Classification: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N (score 9.1), CWE-918.

Remediation: Apply Microsoft Exchange Server 2019 Cumulative Update 9 or upgrade to the latest version.

## PoC / Detection
Classification: rce

The template sends two unauthenticated GET requests to crafted Autodiscover JSON paths incorporating an email-parameter SSRF vector:

- `{{BaseURL}}/autodiscover/autodiscover.json?@test.com/owa/?&Email=autodiscover/autodiscover.json%3F@test.com`
- `{{BaseURL}}/autodiscover/autodiscover.json?@test.com/mapi/nspi/?&Email=autodiscover/autodiscover.json%3F@test.com`

It matches the response body (OR condition) for the strings "Microsoft.Exchange.Clients.Owa2.Server.Core.OwaADUserNotFoundException" or "Exchange MAPI/HTTP Connectivity Endpoint" to confirm the vulnerable condition.

## References
- https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34473
- https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html
- https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1
- https://nvd.nist.gov/vuln/detail/CVE-2021-34473
- https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2021-34473
