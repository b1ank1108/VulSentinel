---
cve_id: CVE-2021-30128
template_path: nuclei-templates/http/cves/2021/CVE-2021-30128.yaml
affected_product: Apache OFBiz
severity: critical
authentication: none
external_callback: true
affected_versions: before 17.12.07
preconditions: []
poc_classification: rce
---

## Vulnerability
Apache OFBiz before 17.12.07 is susceptible to arbitrary code execution via unsafe deserialization. An attacker can modify deserialized data or code without using provided accessor functions. CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H (score 9.8). CWE-502. Impact: full remote code execution on the target system.

## PoC / Detection
Classification: rce  
The template sends one raw POST request to `/webtools/control/SOAPService` with a SOAP envelope containing a map entry that embeds a custom Java deserialization gadget (`{{generate_java_gadget("dns", "https://{{interactsh-url}}", "hex")}}`). Detection succeeds on an out-of-band DNS interaction (via interactsh_protocol matcher) plus the string `value="errorMessage"` in the response body, confirming the unsafe deserialization path was reached.

## References
- https://lists.apache.org/thread.html/rbe8439b26a71fc3b429aa793c65dcc4a6e349bc7bb5010746a74fa1d@%3Ccommits.ofbiz.apache.org%3E
- https://lists.apache.org/thread.html/rb3f5cd65f3ddce9b9eb4d6ea6e2919933f0f89b15953769d11003743%40%3Cdev.ofbiz.apache.org%3E
- https://lists.apache.org/thread.html/rb3f5cd65f3ddce9b9eb4d6ea6e2919933f0f89b15953769d11003743@%3Cdev.ofbiz.apache.org%3E
- https://nvd.nist.gov/vuln/detail/CVE-2021-30128
- http://www.openwall.com/lists/oss-security/2021/04/27/5
