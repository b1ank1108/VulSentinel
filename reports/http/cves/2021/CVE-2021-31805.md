---
cve_id: CVE-2021-31805
template_path: nuclei-templates/http/cves/2021/CVE-2021-31805.yaml
affected_product: Apache Struts2
severity: critical
authentication: none
external_callback: false
affected_versions: prior to 2.5.30
preconditions: uses forced OGNL evaluation with %{...} syntax on untrusted user input
poc_classification: rce
---

## Vulnerability
Apache Struts2 S2-062 (CVE-2021-31805) is a critical remote code execution vulnerability resulting from an incomplete patch for S2-061 (CVE-2020-17530). Certain tag attributes remain susceptible to double OGNL expression evaluation when forced evaluation syntax (`%{...}`) is applied to untrusted input.

CVSS: 9.8 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H). Impact includes full server compromise via arbitrary command execution. CWE-917.

## PoC / Detection
Classification: rce

The template sends a raw multipart/form-data POST request to `/` embedding a sophisticated OGNL payload in the `id` form field parameter. The payload manipulates internal BeanMaps to bypass member access restrictions and invokes `freemarker.template.utility.Execute` to run `cat /etc/passwd`. Detection succeeds if the server response body contains Linux passwd entries matching the regex `root:.*:0:0:`.

## References
- https://cwiki.apache.org/confluence/display/WW/S2-062
- https://github.com/Axx8/Struts2_S2-062_CVE-2021-31805
- https://nvd.nist.gov/vuln/detail/CVE-2021-31805
- http://www.openwall.com/lists/oss-security/2022/04/12/6
- https://security.netapp.com/advisory/ntap-20220420-0001/
