---
cve_id: CVE-2021-31195
template_path: nuclei-templates/http/cves/2021/CVE-2021-31195.yaml
affected_product: Microsoft Exchange Server
severity: medium
authentication: none
external_callback: false
affected_versions: 2013 Cumulative Update 23
preconditions: []
poc_classification: info-leak
---

## Vulnerability
Microsoft Exchange Server (including Outlook Web Access / OWA) contains a reflected cross-site scripting (XSS) vulnerability (CVE-2021-31195, CWE-79) in the `refurl` parameter of the `frowny.aspx` endpoint (description references `frowny.asp`). 

CVSS 3.1 score 6.5 (AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N). An unauthenticated remote attacker can supply a malicious URL that injects and executes arbitrary JavaScript in the context of a victim's authenticated browser session when the link is visited.

Impact includes session hijacking, credential theft, or other client-side attacks against users interacting with the Exchange web interface.

Remediation requires applying the latest Microsoft security updates.

## PoC / Detection
Classification: info-leak

The template issues a single GET request to `{{BaseURL}}/owa/auth/frowny.aspx?app=people&et=ServerError&esrc=MasterPage&te=\&refurl=}}};alert(document.domain)//` and confirms the flaw if the resulting HTTP 500 response body simultaneously contains the unsanitized payload fragment `alert(document.domain)//&et=ServerError`, the OWA-specific string `mail/bootr.ashx`, `Content-Type: text/html`, proving the `refurl` value is reflected without encoding.

## References
- https://blog.orange.tw/2021/08/proxyoracle-a-new-attack-surface-on-ms-exchange-part-2.html
- https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31195
- https://nvd.nist.gov/vuln/detail/CVE-2021-31195
- https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2021-31195
- https://github.com/ARPSyndicate/kenzer-templates
