---
cve_id: CVE-2021-39226
template_path: nuclei-templates/http/cves/2021/CVE-2021-39226.yaml
affected_product: Grafana
severity: high
authentication: none
external_callback: false
affected_versions: up to 7.5.11 and 8.1.5
preconditions: []
poc_classification: auth-bypass
---

## Vulnerability

Grafana instances up to 7.5.11 and 8.1.5 allow remote unauthenticated users to view the snapshot associated with the lowest database key by accessing the literal paths `/api/snapshots/:key` or `/dashboard/snapshot/:key`. If the snapshot is in public mode, unauthenticated users can delete snapshots by accessing the endpoint `/api/snapshots-delete/:deleteKey`. Authenticated users can also delete snapshots by accessing the endpoints `/api/snapshots-delete/:deleteKey`, or sending a delete request to `/api/snapshot/:key`, regardless of whether or not the snapshot is set to public mode (disabled by default). This is an authentication bypass (CWE-287) with CVSS 3.1 score 7.3 (AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L).

## PoC / Detection
Classification: auth-bypass

The template issues unauthenticated GET requests to `{{BaseURL}}/api/snapshots/:key` and `{{BaseURL}}/dashboard/snapshot/:key` (literal `:key` paths). It detects successful bypass when the response returns status 200 and contains the string `"isSnapshot":true`.

## References
- https://github.com/advisories/GHSA-69j6-29vr-p3j9
- https://nvd.nist.gov/vuln/detail/CVE-2021-39226
- https://github.com/grafana/grafana/commit/2d456a6375855364d098ede379438bf7f0667269
- https://grafana.com/docs/grafana/latest/release-notes/release-notes-8-1-6/
- http://www.openwall.com/lists/oss-security/2021/10/05/4
