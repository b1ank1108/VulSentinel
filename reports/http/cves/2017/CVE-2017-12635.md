---
cve_id: CVE-2017-12635
template_path: nuclei-templates/http/cves/2017/CVE-2017-12635.yaml
affected_product: Apache CouchDB
severity: critical
authentication: none
external_callback: false
affected_versions: before 1.7.0 and 2.x before 2.1.1
preconditions: []
poc_classification: auth-bypass
---

## Vulnerability
Apache CouchDB before 1.7.0 and 2.x before 2.1.1 is affected by CVE-2017-12635 (CWE-269), a remote privilege escalation vulnerability.

Due to differences in the Erlang-based JSON parser and JavaScript-based JSON parser, it is possible to submit `_users` documents with duplicate keys for 'roles' used for access control within the database, including the special case '_admin' role. By design, users cannot assign themselves roles. The vulnerability allows non-admin users to give themselves admin privileges. In combination with CVE-2017-12636 this can be used to give non-admin users access to arbitrary shell commands on the server as the database system user.

**Impact:** Remote attackers can exploit this vulnerability to escalate privileges.  
**Remediation:** Upgrade Apache CouchDB to version 2.1.1 or later.  
**CVSS 3.0:** 9.8 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)

## PoC / Detection
Classification: auth-bypass

The template performs a single unauthenticated raw HTTP PUT request to `/_users/org.couchdb.user:poc` containing a JSON user document with duplicate "roles" keys (first `["_admin"]`, second `[]`) plus name, type and password fields. It matches on response headers containing `application/json` and `Location:`, body containing `org.couchdb.user:poc`, `conflict` or `Document update conflict`, and HTTP status 201 or 409.

## References
- https://nvd.nist.gov/vuln/detail/CVE-2017-12635
- https://lists.apache.org/thread.html/6c405bf3f8358e6314076be9f48c89a2e0ddf00539906291ebdf0c67@%3Cdev.couchdb.apache.org%3E
- https://security.gentoo.org/glsa/201711-16
- https://lists.debian.org/debian-lts-announce/2018/01/msg00026.html
- https://support.hpe.com/hpsc/doc/public/display?docLocale=en_US&docId=emr_na-hpesbmu03935en_us
