---
cve_id: CVE-2017-5638
template_path: nuclei-templates/http/cves/2017/CVE-2017-5638.yaml
affected_product: Apache Struts 2
severity: critical
authentication: none
external_callback: false
affected_versions: 2.3.x before 2.3.32 and 2.5.x before 2.5.10.1
preconditions: []
poc_classification: rce
---

## Vulnerability
Apache Struts 2.3.x before 2.3.32 and 2.5.x before 2.5.10.1 is susceptible to remote command injection attacks. The Jakarta Multipart parser has incorrect exception handling and error-message generation during file upload attempts, which can allow an attacker to execute arbitrary commands via a crafted Content-Type, Content-Disposition, or Content-Length HTTP header. This was exploited in March 2017 with a Content-Type header containing a #cmd= string. Impact: Remote attackers can execute arbitrary commands on the target system. Remediation: Upgrade to Apache Struts 2.3.32 or 2.5.10.1 or apply the necessary patches. CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H (10.0). CPE: cpe:2.3:a:apache:struts:2.3.5:*:*:*:*:*:*:*.

## PoC / Detection
Classification: rce  
The template sends a single raw GET request to `/` with a crafted `Content-Type` header containing an OGNL expression that sets `#cmd="cat /etc/passwd"`, builds a ProcessBuilder, executes it, and writes the output to the HTTP response writer. Detection succeeds if the response status is 200 and the body matches the regex `root:.*:0:0:` (confirming command execution and leakage of `/etc/passwd` contents).

## References
- https://github.com/mazen160/struts-pwn
- https://isc.sans.edu/diary/22169
- https://github.com/rapid7/metasploit-framework/issues/8064
- https://nvd.nist.gov/vuln/detail/CVE-2017-5638
- http://blog.talosintelligence.com/2017/03/apache-0-day-exploited.html
