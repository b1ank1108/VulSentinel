---
cve_id: CVE-2022-29153
template_path: nuclei-templates/http/cves/2022/CVE-2022-29153.yaml
affected_product: HashiCorp Consul
severity: high
authentication: none
external_callback: false
affected_versions: <=1.9.16, <=1.10.9, <=1.11.4
preconditions: [HTTP health check endpoints configured without disable_redirects option]
poc_classification: info-leak
---

## Vulnerability

HashiCorp Consul and Consul Enterprise versions up to 1.9.16, 1.10.9, and 1.11.4 are vulnerable to server-side request forgery (SSRF) through HTTP health check endpoints. The vulnerability (CWE-918) stems from Consul's default behavior of following HTTP redirects returned by health check endpoints without restriction. This allows an attacker to craft malicious health check configurations that redirect Consul's internal HTTP client to arbitrary internal or external resources.

The CVSS v3.1 score is 7.5 (High severity) with vector CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N, indicating network-exploitable, low complexity, requiring no privileges or user interaction, with high impact to integrity. The EPSS score of 0.87417 (99.442nd percentile) indicates a very high probability of active exploitation.

An attacker can register malicious health checks that cause Consul to make requests to internal resources, potentially accessing sensitive information, modifying data, or executing unauthorized operations against internal services that trust requests from the Consul server.

## PoC / Detection

Classification: info-leak

The template detects vulnerable Consul instances by attempting to register a health check with the `disable_redirects` option. This detection approach works because:

1. **Request 1**: Sends a PUT request to `/v1/agent/check/register` to register a test health check node with the `disable_redirects` field set to `true`. The check points to a safe external URL (oast.me) with a 10-second interval.

2. **Request 2**: Immediately deregisters the test node via PUT request to `/v1/agent/check/deregister/{{randstr}}` to clean up.

The template identifies vulnerable versions by checking for the error response "unknown field 'disable_redirects'" with HTTP status 400. Vulnerable versions (prior to the fix) do not recognize the `disable_redirects` configuration option, indicating they lack the mitigation control and will follow redirects by default. Patched versions (1.9.17, 1.10.10, 1.11.5+) accept this field without error.

Note: This template is marked as "intrusive" as it actively registers (then deregisters) a check configuration on the target Consul agent.

## References

- https://discuss.hashicorp.com/t/hcsec-2022-10-consul-s-http-health-check-may-allow-server-side-request-forgery/38393
- https://github.com/hashicorp/consul/pull/12685
- https://developer.hashicorp.com/consul/docs/discovery/checks
- https://nvd.nist.gov/vuln/detail/CVE-2022-29153
- https://discuss.hashicorp.com
