---
cve_id: CVE-2022-39952
template_path: nuclei-templates/http/cves/2022/CVE-2022-39952.yaml
affected_product: Fortinet FortiNAC
severity: critical
authentication: none
external_callback: false
affected_versions: 9.4.0, 9.2.0-9.2.5, 9.1.0-9.1.7, 8.8.0-8.8.11, 8.7.0-8.7.6, 8.6.0-8.6.5, 8.5.0-8.5.4, 8.3.7
preconditions: []
poc_classification: rce
---

## Vulnerability

Fortinet FortiNAC contains an arbitrary file write vulnerability (CWE-73: External Control of File Name or Path, CWE-668: Exposure of Resource to Wrong Sphere) that allows unauthenticated remote attackers to write arbitrary files to the system. The vulnerability exists in the `/configWizard/keyUpload.jsp` endpoint, which fails to properly validate file upload requests. An attacker can exploit this flaw by sending a specially crafted HTTP POST request with a malicious multipart form-data payload, enabling them to upload arbitrary files to the server. This can lead to remote code execution, unauthorized access to sensitive information, data modification, and execution of unauthorized operations.

The vulnerability has a CVSS v3.1 score of 9.8 (Critical) with the vector CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H, indicating network-based exploitation requiring no privileges or user interaction. The EPSS score of 0.93777 (99.848th percentile) indicates an extremely high probability of active exploitation in the wild.

Affected versions include 9.4.0, 9.2.0 through 9.2.5, 9.1.0 through 9.1.7, 8.8.0 through 8.8.11, 8.7.0 through 8.7.6, 8.6.0 through 8.6.5, 8.5.0 through 8.5.4, and 8.3.7. Remediation requires upgrading to version 9.4.1, 9.2.6, 9.1.8, 7.2.0 or above.

## PoC / Detection

Classification: rce

The template detects this vulnerability by sending an unauthenticated HTTP POST request to the `/configWizard/keyUpload.jsp` endpoint with a crafted multipart form-data payload. The request uploads a ZIP file with random content using a randomly generated boundary identifier and filename. The template verifies successful exploitation by checking for three conditions in the response: (1) the presence of both "zipUploadSuccess" and "SuccessfulUpload" strings in the response body, (2) a "text/html" content-type header, and (3) an HTTP 200 status code. These indicators confirm that the server accepted and processed the arbitrary file upload, demonstrating the presence of the arbitrary file write vulnerability that can be leveraged for remote code execution.

## References

- https://fortiguard.com/psirt/FG-IR-22-300
- https://www.horizon3.ai/fortinet-fortinac-cve-2022-39952-deep-dive-and-iocs/
- https://github.com/horizon3ai/CVE-2022-39952
- https://nvd.nist.gov/vuln/detail/CVE-2022-39952
- https://github.com/1f3lse/taiE
