---
cve_id: CVE-2022-22954
template_path: nuclei-templates/http/cves/2022/CVE-2022-22954.yaml
affected_product: VMware Workspace ONE Access
severity: critical
authentication: none
external_callback: false
affected_versions: unknown
preconditions: []
poc_classification: rce
---

## Vulnerability

VMware Workspace ONE Access and VMware Identity Manager contain a critical server-side template injection (SSTI) vulnerability. An unauthenticated attacker with network access can exploit this flaw by sending a specially crafted request to a vulnerable instance. The vulnerability stems from improper handling of user-supplied input in template processing, specifically through the FreeMarker template engine. This allows arbitrary template expressions to be evaluated server-side, leading to remote code execution.

The vulnerability is classified as CWE-94 (Improper Control of Generation of Code - Code Injection) with a CVSS v3.1 score of 9.8 (Critical). The attack vector is network-based, requires low complexity, no privileges, and no user interaction. Successful exploitation compromises the confidentiality, integrity, and availability of the affected system. This vulnerability has an EPSS score of 0.94444 (99.99th percentile), indicating extremely high likelihood of exploitation in the wild. It is listed in the Known Exploited Vulnerabilities (KEV) catalog.

## PoC / Detection

Classification: rce

The template detects this vulnerability by sending a GET request to the `/catalog-portal/ui/oauth/verify` endpoint with a malicious `deviceUdid` parameter. The parameter contains a URL-encoded FreeMarker template injection payload: `${"freemarker.template.utility.Execute"?new()("cat /etc/hosts")}`. This payload attempts to instantiate the Execute utility class and run the `cat /etc/hosts` command.

The template verifies the vulnerability by checking for two conditions:
1. The response body contains the string "Authorization context is not valid"
2. The HTTP status code is 400

These matchers indicate that the injected template expression was processed by the server (triggering the specific error message), confirming the presence of the SSTI vulnerability. While the detection payload uses a harmless command (`cat /etc/hosts`), the underlying vulnerability allows arbitrary command execution, making this a remote code execution flaw.

## References

- https://www.tenable.com/blog/vmware-patches-multiple-vulnerabilities-in-workspace-one-vmsa-2022-0011
- https://www.vmware.com/security/advisories/VMSA-2022-0011.html
- http://packetstormsecurity.com/files/166935/VMware-Workspace-ONE-Access-Template-Injection-Command-Execution.html
- https://nvd.nist.gov/vuln/detail/CVE-2022-22954
