---
cve_id: CVE-2022-22897
template_path: nuclei-templates/http/cves/2022/CVE-2022-22897.yaml
affected_product: PrestaShop AP Pagebuilder
severity: critical
authentication: none
external_callback: false
affected_versions: <= 2.4.4
preconditions: [AP PageBuilder module installed on PrestaShop]
poc_classification: info-leak
---

## Vulnerability
A critical SQL injection (CWE-89) in the ApolloTheme AP PageBuilder component (through 2.4.4) for PrestaShop exists in the `product_one_img`/`pro_add`/`product_all_one_img`/`image_product` parameters of `/modules/appagebuilder/apajax.php`. Unauthenticated remote attackers can inject arbitrary SQL queries, enabling database data exfiltration.  

**CVSS 3.1**: 9.8 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)  
**Impact**: Full read access to database contents; potential for further unauthorized access or data leakage.  
**Remediation**: Upgrade AP PageBuilder to 2.4.5 or later.

## PoC / Detection
Classification: info-leak

The template first performs version fingerprinting with a GET request to `/modules/appagebuilder/config.xml` and extracts the `<version>` tag via regex. It then issues multiple POST requests to `/modules/appagebuilder/apajax.php?rand=…` (with `leoajax=1`) containing:  
- Time-based payloads injecting `if(now()=sysdate(),sleep(6),0)` into `product_one_img` and `pro_add` parameters; matches on `duration >=6s` + `version <= 2.4.4`.  
- Boolean blind payloads using `OR 6644=6644` (true) vs `OR 6643=6644` (false); matches on differential response bodies (content presence, length >200 vs ≤22, Hostname inclusion).  
- Error-based payload triggering visible "You have an error in your SQL syntax" messages.  

All checks are gated by the version comparison from the config file.

## References
- https://nvd.nist.gov/vuln/detail/CVE-2022-22897
- https://packetstormsecurity.com/files/cve/CVE-2022-22897
- https://security.friendsofpresta.org/modules/2023/01/05/appagebuilder.html
