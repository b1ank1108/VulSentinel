---
cve_id: CVE-2022-36804
template_path: nuclei-templates/http/cves/2022/CVE-2022-36804.yaml
affected_product: Atlassian Bitbucket
severity: high
authentication: optional
external_callback: false
affected_versions: 7.0.0 before 7.6.17, 7.7.0 before 7.17.10, 7.18.0 before 7.21.4, 8.0.0 before 8.0.3, 8.1.0 before 8.1.3, 8.2.0 before 8.2.2, 8.3.0 before 8.3.1
preconditions: read permissions to a public or private repository
poc_classification: rce
---

## Vulnerability
Atlassian Bitbucket Server and Data Center suffers from remote command injection via the repository archive API endpoint. An attacker with read access to a repository can inject arbitrary commands (e.g. via crafted `prefix` parameter with null bytes and `--exec`).

This leads to RCE, enabling sensitive data access, data modification, and full system compromise.

CVSS: 8.8 (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H) | CWE-77

## PoC / Detection
Classification: rce

The template first performs GET /rest/api/latest/repos to enumerate and extract (via JSON) the project `key` and repository `slug` of the first available repo (iterate-all enabled). It then issues a second GET to /rest/api/latest/projects/{{key}}/repos/{{slug}}/archive using malicious query params (`filename`, `at`, `path`, `prefix=ax%00--exec=`id`%00--remote=origin`) to trigger command injection of the `id` command.

Success is matched by HTTP 500 status containing the string "com.atlassian.bitbucket.scm.CommandFailedException". A regex extractor captures potential `uid=` output from the error response indicating command execution.

## References
- https://github.com/notdls/CVE-2022-36804
- https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-36804
- https://jira.atlassian.com/browse/BSERV-13438
- https://nvd.nist.gov/vuln/detail/CVE-2022-36804
- http://packetstormsecurity.com/files/171453/Bitbucket-7.0.0-Remote-Command-Execution.html
