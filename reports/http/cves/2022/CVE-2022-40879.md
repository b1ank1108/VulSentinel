---
cve_id: CVE-2022-40879
template_path: nuclei-templates/http/cves/2022/CVE-2022-40879.yaml
affected_product: kkFileView
severity: medium
authentication: none
external_callback: false
affected_versions: 4.1.0
preconditions: []
poc_classification: info-leak
---

## Vulnerability
kkFileView 4.1.0 (keking vendor) suffers from a reflected cross-site scripting (XSS) vulnerability (CWE-79) via the `errorMsg` parameter when processing the `url` argument to the `/onlinePreview` endpoint. An attacker can craft a malicious preview link that injects arbitrary JavaScript executed in the victim's browser context (same-origin). 

CVSS v3.1: 6.1 (AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N). Impact includes cookie theft (session hijacking), page defacement, or exfiltration of sensitive information. Remediation requires upgrading beyond 4.1.0. Template is verified true; endpoint returns `text/html` on success.

## PoC / Detection
Classification: info-leak

The template issues one unauthenticated GET request to `{{BaseURL}}/onlinePreview?url=aHR0cHM6Ly93d3cuZ29vZ2xlLjxpbWcgc3JjPTEgb25lcnJvcj1hbGVydChkb2N1bWVudC5kb21haW4pPj1QUQ==` (base64 payload embedding `<img src=1 onerror=alert(document.domain)>`). It matches on body containing both the unsanitized payload string `'<img src=1 onerror=alert(document.domain)>=PQ</p>'` AND the error fragment `该文件不`, plus `text/html` Content-Type and HTTP 200. This confirms reflection of unsanitized input enabling XSS without server-side sanitization or encoding.

## References
- https://github.com/kekingcn/kkFileView/issues/389
- https://nvd.nist.gov/vuln/detail/CVE-2022-40879
- https://github.com/ARPSyndicate/cvemon
- https://github.com/ARPSyndicate/kenzer-templates
- https://github.com/Henry4E36/POCS
