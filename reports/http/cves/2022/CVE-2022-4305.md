---
cve_id: CVE-2022-4305
template_path: nuclei-templates/http/cves/2022/CVE-2022-4305.yaml
affected_product: WordPress Login as User or Customer plugin
severity: critical
authentication: none
external_callback: false
affected_versions: < 3.3
preconditions: [Login as User or Customer plugin installed and activated on WordPress site]
poc_classification: auth-bypass
---

## Vulnerability
The WordPress Login as User or Customer plugin (wp-buy) prior to 3.3 lacks authorization checks on the `loginas_return_admin` AJAX action (CWE-269). Unauthenticated remote attackers can set the `loginas_old_user_id=1` cookie to impersonate any user (including administrators) and obtain a valid admin session, enabling full site takeover and control over all user accounts and content. CVSS 3.1: 9.8 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H). Fixed in version 3.3.

## PoC / Detection
Classification: auth-bypass

The template verifies the flaw by performing the exact exploit sequence: a raw GET to `/wp-admin/admin-ajax.php?action=loginas_return_admin` injecting `Cookie: loginas_old_user_id=1`, followed by a GET to `/wp-admin/users.php`. It matches on the second response being HTTP 200 with `text/html` content-type and containing both 'Edit Profile' and 'All Posts' strings, confirming successful privilege escalation to admin without any prior credentials.

## References
- https://wpscan.com/vulnerability/286d972d-7bda-455c-a226-fd9ce5f925bd
- https://nvd.nist.gov/vuln/detail/CVE-2022-4305
- https://github.com/cyllective/CVEs
