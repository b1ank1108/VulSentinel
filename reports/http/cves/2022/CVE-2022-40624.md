---
cve_id: CVE-2022-40624
template_path: nuclei-templates/http/cves/2022/CVE-2022-40624.yaml
affected_product: pfSense pfBlockerNG
severity: critical
authentication: none
external_callback: false
affected_versions: â‰¤2.1.4_27
preconditions: []
poc_classification: rce
---

## Vulnerability

CVE-2022-40624 is a critical OS command injection vulnerability in pfSense pfBlockerNG through version 2.1.4_27. The vulnerability allows remote attackers to execute arbitrary operating system commands with root privileges via the HTTP Host header. This is a CWE-78 (OS Command Injection) vulnerability with a CVSS score of 9.8, indicating critical severity. The vulnerability requires no authentication and can be exploited remotely over the network with low attack complexity. The EPSS score of 0.87488 (99.445th percentile) indicates a very high probability of active exploitation in the wild.

## PoC / Detection

Classification: rce

The template performs a two-stage detection process to verify the command injection vulnerability:

1. **Initial verification**: Sends a GET request to `/pfblockerng/www/index.php` with a standard Host header to confirm the pfBlockerNG endpoint is accessible and responds with a GIF image (checking for "GIF" in the body and "image/gif" content type).

2. **Command injection probe**: Sends a second GET request to the same endpoint with a malicious Host header containing the payload `' *; sleep 7; '`. This payload attempts to inject a shell command that causes a 7-second delay. The template uses an unsafe HTTP request with a 20-second timeout and verifies exploitation by checking if the response duration is 7 seconds or greater, confirming that the injected `sleep` command was executed by the server with root privileges.

## References

- https://github.com/dhammon/pfBlockerNg-CVE-2022-40624
- https://nvd.nist.gov/vuln/detail/CVE-2022-40624
