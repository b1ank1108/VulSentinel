---
cve_id: CVE-2022-40047
template_path: nuclei-templates/http/cves/2022/CVE-2022-40047.yaml
affected_product: Flatpress
severity: medium
authentication: required
external_callback: false
affected_versions: < v1.2.1
preconditions: []
---

## Vulnerability

CVE-2022-40047 is a reflected cross-site scripting (XSS) vulnerability in Flatpress versions prior to v1.2.1. The vulnerability exists in the `/flatpress/admin.php` endpoint where the `page` parameter is not properly sanitized or encoded before being reflected in the HTML response. Authenticated attackers can craft malicious URLs containing JavaScript payloads in the `page` parameter that execute when other authenticated users (including administrators) access the malicious link. This can lead to session token theft, unauthorized actions performed in the context of the victim's session, or other client-side attacks within the Flatpress blog administration interface.

The vulnerability is classified as CWE-79 (Improper Neutralization of Input During Web Page Generation) with a CVSS v3.1 score of 5.4 (Medium severity). The attack vector is network-based with low attack complexity, but requires low-level privileges (authentication) and user interaction (victim must click the malicious link). The scope is changed, meaning the vulnerable component impacts resources beyond its security scope.

## PoC / Detection

Classification: **state-change**

The template performs authenticated exploitation testing through a two-step process:

1. **Authentication Step**: Sends a POST request to `/login.php` with credentials (`username` and `password` variables) using multipart/form-data encoding to establish an authenticated session.

2. **XSS Injection Step**: Sends a GET request to `/admin.php` with the following parameters:
   - `p=static`
   - `action=write`
   - `page="onfocus="alert(document.domain)"autofocus="zr4da`
   
   The payload injects an `onfocus` event handler with `alert(document.domain)` and an `autofocus` attribute to trigger automatic execution.

The template confirms the vulnerability by verifying:
- HTTP 200 response status
- Response contains "flatpress" string (confirming the application)
- Content-Type is "text/html"
- Response body contains the injected payload `onfocus="alert(document.domain)"` without proper encoding

This demonstrates that the XSS payload is reflected in the response and would execute in a victim's browser, allowing unauthorized actions within the authenticated session context.

## References

- https://nvd.nist.gov/vuln/detail/CVE-2022-40047
- https://github.com/flatpressblog/flatpress/issues/153
- http://flatpress.com
