---
cve_id: CVE-2023-30013
template_path: nuclei-templates/http/cves/2023/CVE-2023-30013.yaml
affected_product: TOTOLINK X5000R
severity: critical
authentication: none
external_callback: false
affected_versions: 9.1.0u.6118_B20201102, 9.1.0u.6369_B20230113
preconditions: []
poc_classification: rce
---

## Vulnerability

CVE-2023-30013 is an unauthenticated command injection vulnerability affecting TOTOLINK X5000R routers running firmware versions 9.1.0u.6118_B20201102 and 9.1.0u.6369_B20230113. The vulnerability exists in the `setting/setTracerouteCfg` endpoint, specifically in the "command" parameter processing. An attacker can inject arbitrary OS commands without authentication through this parameter, leading to complete device compromise. The vulnerability is classified as CWE-78 (OS Command Injection) with a CVSS score of 9.8, indicating critical severity. The attack vector is network-based, requires low complexity, no privileges, and no user interaction. Successful exploitation allows unauthenticated attackers to execute arbitrary commands on the router, potentially leading to network takeover and access to all connected devices.

## PoC / Detection

Classification: rce

The template performs a two-step detection process to verify the command injection vulnerability:

1. **Command Injection**: Sends a POST request to `/cgi-bin/cstecgi.cgi` with a JSON payload containing a malicious command in the "command" parameter. The injected command (`127.0.0.1; ls>../{{randstr}};#`) executes a directory listing and redirects output to a file with a random name in the parent directory. The payload targets the `setTracerouteCfg` topic URL.

2. **Verification**: Sends a GET request to retrieve the created file (`/{{randstr}}`), confirming command execution was successful.

The template validates exploitation by checking:
- The first response contains "lan_ip" and "reserv" (indicating successful API interaction)
- The second response contains ".sh" and ".cgi" (confirming directory listing output from the injected command)
- Both responses return HTTP 200 status

This is an intrusive test that creates files on the target system to verify remote code execution capability.

## References

- https://nvd.nist.gov/vuln/detail/CVE-2023-30013
- https://github.com/Kazamayc/vuln/tree/main/TOTOLINK/X5000R/2
- http://packetstormsecurity.com/files/174799/TOTOLINK-Wireless-Routers-Remote-Command-Execution.html
- https://github.com/h00die-gr3y/Metasploit
