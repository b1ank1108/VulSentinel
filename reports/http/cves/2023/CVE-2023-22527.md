---
cve_id: CVE-2023-22527
template_path: nuclei-templates/http/cves/2023/CVE-2023-22527.yaml
affected_product: Atlassian Confluence
severity: critical
authentication: none
external_callback: false
affected_versions: older versions of Confluence Data Center and Server prior to August 2023 IR, May 2023 Patch 4, February 2023 Patch 8, November 2022 Patch 11, or August 2022 Patch 13
preconditions: []
poc_classification: rce
---

## Vulnerability

A template injection vulnerability in older versions of Atlassian Confluence Data Center and Server allows an unauthenticated attacker to achieve remote code execution (RCE). The vulnerability occurs in the `text-inline.vm` Velocity template endpoint through improper handling of user-controlled input, enabling OGNL/Freemarker injection leading to arbitrary command execution.

**CVSS:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)  
**CWE:** CWE-74  
**Impact:** Unauthenticated attackers can execute arbitrary system commands and fully compromise affected Confluence installations.  
**Remediation:** Update to August 2023 IR, May 2023 Patch 4, February 2023 Patch 8, November 2022 Patch 11, or August 2022 Patch 13.

## PoC / Detection
Classification: rce

The template sends a single POST request to `/template/aui/text-inline.vm` containing a URL-encoded payload that injects into the template engine: `label=aaa\u0027%2b#request.get(\u0027.KEY_velocity.struts2.context\u0027).internalGet(\u0027ognl\u0027).findValue(#parameters.poc[0],{})%2b\u0027` combined with a `poc` parameter invoking Freemarker `Execute` to run `whoami` and set a custom header `x_vuln_check`. Detection relies on DSL conditions confirming the header exists and the body contains `empty{name=`. The command output is extracted from the `x_vuln_check` header.

## References
- https://confluence.atlassian.com/pages/viewpage.action?pageId=1333335615
- https://jira.atlassian.com/browse/CONFSERVER-93833
- https://blog.projectdiscovery.io/atlassian-confluence-ssti-remote-code-execution/
- http://packetstormsecurity.com/files/176789/Atlassian-Confluence-SSTI-Injection.html
- https://github.com/ramirezs4/Tips-and-tools-forensics---RS4
