---
cve_id: CVE-2023-25157
template_path: nuclei-templates/http/cves/2023/CVE-2023-25157.yaml
affected_product: GeoServer
severity: critical
authentication: none
external_callback: false
affected_versions: <2.21.4, <2.22.2
preconditions: [PostGIS Datastore with encode functions enabled, or preparedStatements disabled]
poc_classification: info-leak
---

## Vulnerability

GeoServer contains a SQL injection vulnerability in its OGC Filter expression language and Common Query Language (CQL) implementation. The vulnerability affects the Web Feature Service (WFS), Web Map Service (WMS), and Web Coverage Service (WCS) protocols when used with PostGIS DataStore. The flaw allows unauthenticated attackers to inject arbitrary SQL queries through specially crafted CQL filter expressions, specifically through misuse of `strEndsWith`, `strStartsWith`, `PropertyIsLike`, and `FeatureId` functions. This critical vulnerability (CVSS 9.8) can lead to unauthorized database access, data leakage, and data manipulation. The issue is tracked as CWE-89 (SQL Injection) and has an EPSS score of 0.94, indicating a very high probability of exploitation in the wild.

## PoC / Detection

Classification: info-leak

The template performs a three-stage detection process to identify the SQL injection vulnerability:

1. **Capability Discovery**: Sends a WFS GetCapabilities request to enumerate available feature types on the GeoServer instance
2. **Feature Enumeration**: Retrieves sample features using GetFeature request in CSV format to extract column names from the response
3. **SQL Injection Probe**: Exploits the vulnerability by sending a malicious CQL_FILTER parameter using `strStartswith()` function with crafted input (`''''`) that triggers SQL syntax errors

The template detects successful exploitation by matching the presence of "SQL SELECT" error messages in the response body combined with a `text/xml` content-type header, indicating that the server exposed internal SQL query details through error messages. The template uses a 30-second timeout for the injection attempt and employs dynamic extraction to target actual feature types and columns present in the target system.

## References

- https://twitter.com/parzel2/status/1665726454489915395
- https://nvd.nist.gov/vuln/detail/CVE-2023-25157
- https://github.com/win3zz/CVE-2023-25157
- https://github.com/geoserver/geoserver/security/advisories/GHSA-7g5f-wrx8-5ccf
- https://github.com/geoserver/geoserver/commit/145a8af798590288d270b240235e89c8f0b62e1d
