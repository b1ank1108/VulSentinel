---
cve_id: CVE-2018-17153
template_path: nuclei-templates/http/cves/2018/CVE-2018-17153.yaml
affected_product: Western Digital MyCloud NAS
severity: critical
authentication: none
external_callback: false
affected_versions: < 2.30.196
preconditions: []
poc_classification: rce
---

## Vulnerability

CVE-2018-17153 is a critical authentication bypass vulnerability affecting Western Digital My Cloud NAS devices prior to firmware version 2.30.196. The vulnerability stems from improper session management in the device's CGI modules. Specifically, the `network_mgr.cgi` module contains a command called `cgi_get_ipv6` that creates an admin session tied to the requester's IP address when invoked with a `flag=1` parameter, without requiring authentication. Once this session is established, an attacker can invoke authenticated CGI modules by simply sending a `username=admin` cookie in subsequent HTTP requests. The device validates sessions based on IP address binding but fails to verify that the session was created through legitimate authentication. This design flaw allows unauthenticated attackers to escalate privileges to admin level and gain full control of the device, including the ability to execute arbitrary commands.

## PoC / Detection

Classification: rce

The template detects this vulnerability by exploiting the authentication bypass to achieve remote code execution. It sends a POST request to `/web/google_analytics.php` with cookies set to `isAdmin=1; username=admin` (simulating an admin session without prior authentication). The request body contains a command injection payload: `cmd=set&opt=cloud-device-num&arg=0|echo%20\`id\`%20%23`, which attempts to execute the `id` command on the target system. The template confirms successful exploitation by checking for three conditions: (1) the response body contains output matching the pattern of Unix `id` command output (uid, gid, groups), (2) the response contains the string "ganalytics" (indicating the CGI module processed the request), and (3) the HTTP status code is 200. This demonstrates both the authentication bypass and the ability to execute arbitrary system commands.

## References

- https://web.archive.org/web/20170315123948/https://www.stevencampbell.info/2016/12/command-injection-in-western-digital-mycloud-nas/
- https://packetstormsecurity.com/files/173802/Western-Digital-MyCloud-Unauthenticated-Command-Injection.html
- https://securify.nl/nl/advisory/SFY20180102/authentication-bypass-vulnerability-in-western-digital-my-cloud-allows-escalation-to-admin-privileges.html
- https://nvd.nist.gov/vuln/detail/CVE-2016-10108
- http://packetstormsecurity.com/files/173802/Western-Digital-MyCloud-Unauthenticated-Command-Injection.html
