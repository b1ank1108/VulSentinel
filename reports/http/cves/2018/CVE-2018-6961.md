---
cve_id: CVE-2018-6961
template_path: nuclei-templates/http/cves/2018/CVE-2018-6961.yaml
affected_product: VMware NSX SD-WAN Edge
severity: critical
authentication: none
external_callback: false
affected_versions: < 3.1.2
preconditions: []
poc_classification: rce
---

## Vulnerability

CVE-2018-6961 is a critical unauthenticated command injection vulnerability in VMware NSX SD-WAN Edge (formerly VeloCloud Edge) versions prior to 3.1.2. The vulnerability exists in the local web UI diagnostic tools (Ping/Traceroute functionality) accessible through the `/scripts/ajaxPortal.lua` endpoint. An attacker can inject arbitrary operating system commands through the `destination` parameter without requiring any authentication. The vulnerability is classified as CWE-78 (OS Command Injection) with a CVSS v3.0 score of 8.1 (High severity, though marked as critical in the template). Successful exploitation allows unauthenticated remote code execution as root, providing complete system compromise. The EPSS score of 0.93648 (99.835th percentile) indicates this vulnerability is highly likely to be exploited in the wild.

## PoC / Detection

Classification: rce

The template detects this vulnerability by sending two POST requests to `/scripts/ajaxPortal.lua` with command injection payloads in the `destination` parameter of the diagnostic tool interface. The first request injects a backtick-enclosed `id` command (`8.8.8.8\`id\``), while the second uses command substitution syntax with a random marker (`8.8.8.8$(id;echo {{rand}})`). Both requests specify `test=TRACEROUTE` and `_cmd=run_diagnostic` to trigger the vulnerable diagnostic functionality.

The template verifies successful exploitation by checking for:
1. HTTP 200 status with JSON content type and `"status":"OK"` in the response
2. Output matching the pattern of Unix `id` command results (uid/gid values) in the response body, with optional presence of the random marker
3. Absence of error messages like "UNKNOWN_COMMAND" or "Invalid command"

The stop-at-first-match configuration ensures detection stops after the first successful command injection is confirmed.

## References

- https://www.vmware.com/security/advisories/VMSA-2018-0011.html
- https://www.exploit-db.com/exploits/44959
- https://nvd.nist.gov/vuln/detail/CVE-2018-6961
