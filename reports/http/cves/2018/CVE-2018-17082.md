---
cve_id: CVE-2018-17082
template_path: nuclei-templates/http/cves/2018/CVE-2018-17082.yaml
affected_product: PHP
severity: medium
authentication: none
external_callback: false
affected_versions: <5.6.38, 7.0.x <7.0.32, 7.1.x <7.1.22, 7.2.x <7.2.10
preconditions: [PHP running with Apache2 SAPI handler (sapi/apache2handler)]
poc_classification: info-leak
---

## Vulnerability

CVE-2018-17082 is a reflected cross-site scripting (XSS) vulnerability in PHP when running under the Apache2 handler. The vulnerability stems from improper handling of chunked transfer-encoding requests in the `sapi/apache2handler/sapi_apache2.c` component. When a specially crafted chunked request is sent to the server, the malicious payload is reflected in the error response without proper sanitization, allowing attackers to inject and execute arbitrary JavaScript code in the victim's browser context.

The flaw affects PHP versions before 5.6.38, all 7.0.x versions before 7.0.32, all 7.1.x versions before 7.1.22, and all 7.2.x versions before 7.2.10. The vulnerability is classified as CWE-79 (Improper Neutralization of Input During Web Page Generation) with a CVSS v3.0 score of 6.1 (Medium severity). Successful exploitation could lead to session hijacking, credential theft, or other client-side attacks.

## PoC / Detection

Classification: info-leak

The template detects this vulnerability by sending a POST request with `Transfer-Encoding: chunked` header and a malicious XSS payload (`<script>alert(document.domain)</script>`) in the request body. The detection verifies three conditions:

1. The response body contains the reflected payload within a "Bad Request" error message: `Bad Request<script>alert(document.domain)</script>`
2. The response Content-Type is `text/html`
3. The HTTP status code is 400 (Bad Request)

The presence of the unescaped script tag in the HTML error response confirms that the server is vulnerable to XSS through malformed chunked transfer-encoding requests. While the template uses a harmless `alert()` payload for detection purposes, the underlying vulnerability allows execution of arbitrary JavaScript code.

## References

- https://bugs.php.net/bug.php?id=76582
- https://github.com/php/php-src/commit/23b057742e3cf199612fa8050ae86cae675e214e
- https://nvd.nist.gov/vuln/detail/CVE-2018-17082
- https://security.gentoo.org/glsa/201812-01
- https://github.com/ockeghem/web-sec-study/blob/master/why-CVE-2018-17082-is-not-XSS/README.md
