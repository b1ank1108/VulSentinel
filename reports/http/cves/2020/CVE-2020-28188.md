---
cve_id: CVE-2020-28188
template_path: nuclei-templates/http/cves/2020/CVE-2020-28188.yaml
affected_product: TerraMaster TOS
severity: critical
authentication: none
external_callback: true
affected_versions: <= 4.2.06
preconditions: []
poc_classification: rce
---

## Vulnerability

TerraMaster TOS versions 4.2.06 and earlier contain an unauthenticated remote command execution vulnerability. The flaw exists in the `/include/makecvs.php` endpoint where the `Event` parameter is not properly sanitized, allowing remote attackers to inject arbitrary OS commands. A secondary vulnerable endpoint exists at `/tos/index.php?explorer/pathList` with the `path` parameter. This vulnerability is classified as CWE-78 (OS Command Injection) and has a CVSS score of 9.8, indicating critical severity. The vulnerability requires no authentication and allows complete system compromise with high impact to confidentiality, integrity, and availability. This vulnerability has been actively exploited in the wild, including by the Mirai botnet variant "Freakout" for botnet creation.

## PoC / Detection

Classification: rce

The template detects this vulnerability by attempting to trigger an out-of-band HTTP callback that confirms command execution. It sends two HTTP GET requests targeting the vulnerable endpoints:

1. `/include/makecvs.php` with the `Event` parameter containing a command injection payload
2. `/tos/index.php?explorer/pathList` with the `path` parameter containing a similar payload

Both payloads inject a `curl` command that makes an HTTP request to an Interactsh server with a custom User-Agent header containing a randomly generated base64 string. The template uses backticks to execute the injected command. Detection is confirmed when:
- An HTTP callback is received at the Interactsh server (confirming command execution)
- The callback contains the specific User-Agent header with the random identifier

The template stops at the first successful match, indicating either endpoint is exploitable.

## References

- https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/
- https://www.pentest.com.tr/exploits/TerraMaster-TOS-4-2-06-Unauthenticated-Remote-Code-Execution.html
- https://research.checkpoint.com/2021/freakout-leveraging-newest-vulnerabilities-for-creating-a-botnet/
- https://nvd.nist.gov/vuln/detail/CVE-2020-28188
- http://packetstormsecurity.com/files/172880/TerraMaster-TOS-4.2.06-Remote-Code-Execution.html
