---
cve_id: CVE-2020-16846
template_path: nuclei-templates/http/cves/2020/CVE-2020-16846.yaml
affected_product: SaltStack
severity: critical
authentication: none
external_callback: false
affected_versions: <=3002
preconditions: network access to the Salt API
poc_classification: rce
---

## Vulnerability
SaltStack Salt through 3002 allows an unauthenticated user with network access to the Salt API to use shell injections (CWE-78) to run code on the Salt-API using the SSH client. Unauthenticated attackers can execute arbitrary shell commands via the Salt API, leading to complete server compromise and access to all managed systems. CVSS 3.1 score 9.8 (AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H).

## PoC / Detection
Classification: rce

The template issues a single POST request to `{{BaseURL}}/run` using form-encoded body `token=1337&client=ssh&tgt=*&fun=a&roster=<random6>&ssh_priv=<random5>`, with `Content-Type: application/x-www-form-urlencoded`. It matches on status 500, body containing "An unexpected error occurred", CherryPy version in the Server header or body, and `application/json` Content-Type to confirm the vulnerable Salt API implementation.

## References
- https://saltproject.io/on-november-3-2020-saltstack-publicly-disclosed-three-new-cves/
- https://mp.weixin.qq.com/s/R8qw_lWizGyeJS0jOcYXag
- https://github.com/vulhub/vulhub/tree/master/saltstack/CVE-2020-16846
- https://nvd.nist.gov/vuln/detail/CVE-2020-16846
- http://lists.opensuse.org/opensuse-security-announce/2020-11/msg00029.html
