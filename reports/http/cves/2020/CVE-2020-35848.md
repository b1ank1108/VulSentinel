---
cve_id: CVE-2020-35848
template_path: nuclei-templates/http/cves/2020/CVE-2020-35848.yaml
affected_product: Agentejo Cockpit
severity: critical
authentication: none
external_callback: false
affected_versions: <0.12.0
preconditions: []
poc_classification: auth-bypass
---

## Vulnerability

Agentejo Cockpit versions prior to 0.12.0 contain a critical NoSQL injection vulnerability in the Auth controller's `newpassword` method, which handles the user password reset functionality. The vulnerability allows attackers to inject malicious NoSQL operators into database queries without authentication. By manipulating the `token` parameter with NoSQL injection payloads (such as `$func` operators), attackers can execute arbitrary functions and manipulate database queries. This can lead to unauthorized access to user accounts, data leakage through information disclosure, or data corruption. The vulnerability is classified as CWE-89 (SQL Injection) with a CVSS score of 9.8, indicating critical severity with network-based exploitation requiring no privileges or user interaction.

## PoC / Detection

Classification: auth-bypass

The template detects this vulnerability by sending a POST request to the `/auth/newpassword` endpoint with a JSON payload containing a NoSQL injection attempt. The payload injects a `$func` operator with the value `var_dump` into the `token` parameter:

```json
{
  "token": {
    "$func": "var_dump"
  }
}
```

The template verifies the vulnerability by checking if the response body contains a regex pattern matching PHP's `var_dump()` output format: `string([0-9]{1,3}) "rp-([a-f0-9-]+)"`. This pattern indicates that the NoSQL injection successfully executed the `var_dump` function, revealing password reset tokens in the response. The successful execution of arbitrary functions through NoSQL injection in the password reset mechanism allows attackers to bypass authentication controls and potentially reset arbitrary user passwords.

## References

- https://swarm.ptsecurity.com/rce-cockpit-cms/
- https://nvd.nist.gov/vuln/detail/CVE-2020-35848
- https://getcockpit.com/
- https://github.com/agentejo/cockpit/commit/2a385af8d80ed60d40d386ed813c1039db00c466
- https://github.com/agentejo/cockpit/commit/33e7199575631ba1f74cba6b16b10c820bec59af
