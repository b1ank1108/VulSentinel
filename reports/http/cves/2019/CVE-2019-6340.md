---
cve_id: CVE-2019-6340
template_path: nuclei-templates/http/cves/2019/CVE-2019-6340.yaml
affected_product: Drupal
severity: high
authentication: none
external_callback: false
affected_versions: Drupal 8.5.x before 8.5.11 and Drupal 8.6.x before 8.6.10
preconditions: RESTful Web Services module with HAL JSON format enabled on node endpoints
poc_classification: rce
---

## Vulnerability
Drupal core (8.5.x before 8.5.11, 8.6.x before 8.6.10) contains certain field types that do not properly sanitize data from non-form sources. This leads to unsafe deserialization (CWE-502) via the HAL+JSON format, enabling arbitrary PHP code execution.  
CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H (score 8.1).  
Impact: Successful exploitation allows an attacker to execute arbitrary code on the affected Drupal site.  
Remediation: Apply the official security patch provided by Drupal.

## PoC / Detection
Classification: rce  
The template issues a single POST request to `{{BaseURL}}/node/1?_format=hal_json` containing a malicious HAL JSON payload with a GuzzleHttp\Psr7\FnStream PHP object injection gadget. The gadget configures a Guzzle HandlerStack to invoke the `system` function (resolving to command execution). Detection succeeds on HTTP 200 status plus the presence of `uid=`, `gid=`, and `groups=` strings in the response body (output of the injected `id` command).

## References
- https://www.drupal.org/sa-core-2019-003
- https://www.synology.com/security/advisory/Synology_SA_19_09
- https://nvd.nist.gov/vuln/detail/CVE-2019-6340
- https://www.exploit-db.com/exploits/46452/
- https://github.com/CVEDB/PoC-List
