---
cve_id: CVE-2019-3396
template_path: nuclei-templates/http/cves/2019/CVE-2019-3396.yaml
affected_product: Atlassian Confluence Server
severity: critical
authentication: none
external_callback: false
affected_versions: <6.6.12, 6.7.0-6.12.2, 6.13.0-6.13.2, 6.14.0-6.14.1
preconditions: []
poc_classification: rce
---

## Vulnerability

CVE-2019-3396 is a critical path traversal vulnerability in the Widget Connector macro of Atlassian Confluence Server. The vulnerability stems from server-side template injection (SSTI) that allows unauthenticated remote attackers to traverse the file system and achieve remote code execution on Confluence Server or Data Center instances.

The flaw exists in the Widget Connector macro's handling of template parameters. Attackers can manipulate the `_template` parameter to reference arbitrary files on the server (e.g., `../web.xml`), enabling path traversal. This SSTI vulnerability can be escalated to achieve arbitrary code execution, resulting in complete compromise of the Confluence server.

The vulnerability is classified as CWE-22 (Improper Limitation of a Pathname to a Restricted Directory) with a CVSS score of 9.8, indicating critical severity. The EPSS score of 0.94471 (99.997th percentile) demonstrates extremely high exploitation likelihood in the wild. This vulnerability is listed in the Known Exploited Vulnerabilities (KEV) catalog.

Affected versions include:
- Versions before 6.6.12 (6.6.x branch)
- Versions 6.7.0 through 6.12.2 (6.12.x branch)
- Versions 6.13.0 through 6.13.2 (6.13.x branch)
- Versions 6.14.0 through 6.14.1 (6.14.x branch)

## PoC / Detection

Classification: rce

The template detects this vulnerability by sending a POST request to the `/rest/tinymce/1/macro/preview` endpoint with a crafted JSON payload. The payload exploits the Widget Connector macro by setting the `_template` parameter to `../web.xml`, attempting to traverse the directory structure and read the web.xml configuration file.

The detection request includes:
- A JSON body containing a macro definition with `name: "widget"`
- A malicious `_template` parameter value of `../web.xml` to trigger path traversal
- Standard widget parameters (url, width, height) to maintain valid macro structure

The template confirms successful exploitation by checking for:
1. The presence of `<param-name>contextConfigLocation</param-name>` in the response, which is a characteristic string from Confluence's web.xml file
2. HTTP status code 200

While the template itself only demonstrates path traversal by reading web.xml, the underlying vulnerability allows for server-side template injection that can be escalated to remote code execution, making this an RCE-class vulnerability.

## References

- https://github.com/x-f1v3/CVE-2019-3396
- https://nvd.nist.gov/vuln/detail/CVE-2019-3396
- https://jira.atlassian.com/browse/CONFSERVER-57974
- http://packetstormsecurity.com/files/152568/Atlassian-Confluence-Widget-Connector-Macro-Velocity-Template-Injection.html
- https://github.com/ARPSyndicate/cvemon
