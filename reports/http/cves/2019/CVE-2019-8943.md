---
cve_id: CVE-2019-8943
template_path: nuclei-templates/http/cves/2019/CVE-2019-8943.yaml
affected_product: WordPress
severity: medium
authentication: required
external_callback: false
affected_versions: â‰¤5.0.3
preconditions: [Authenticated user with image cropping privileges (typically Author role or higher)]
poc_classification: rce
---

## Vulnerability

CVE-2019-8943 is a path traversal vulnerability in WordPress Core versions through 5.0.3, specifically in the `wp_crop_image()` function. The vulnerability allows authenticated attackers with image cropping privileges to write output images to arbitrary directories on the server filesystem. This is achieved by manipulating the filename parameter to contain two image extensions and path traversal sequences (e.g., `.jpg?/../../file.jpg`). The flaw stems from insufficient validation of the destination path during the image cropping operation, enabling attackers to escape the intended upload directory and write files to arbitrary locations, including the themes directory where PHP files can be executed.

The vulnerability is classified as CWE-22 (Improper Limitation of a Pathname to a Restricted Directory) with a CVSS v3.1 score of 6.5 (AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N), indicating high integrity impact with low privileges required. The EPSS score of 0.93889 (99.867th percentile) suggests this vulnerability is highly likely to be exploited in the wild.

## PoC / Detection

Classification: rce

The template performs a complex multi-step exploitation chain to achieve remote code execution:

1. **Authentication**: Logs into WordPress using provided credentials via POST to `/wp-login.php`
2. **Theme Discovery**: Identifies the active theme by extracting theme name from page source
3. **Image Upload**: Uploads a specially crafted JPEG image containing PHP code (`<?=$_GET[0];?>`) embedded in EXIF metadata
4. **Image Cropping**: Performs initial image crop operation to generate a cropped version
5. **Path Traversal Exploitation**: 
   - Modifies the `_wp_attached_file` metadata to include path traversal sequences
   - Triggers crop operation to write the image to an arbitrary path within the theme directory
   - Repeats the process to place a file with a `.jpg` extension in the theme folder
6. **Template Injection**: Creates a new WordPress post and sets its page template to the cropped malicious image file
7. **Code Execution**: Accesses the post with command injection parameters to execute arbitrary commands through the embedded PHP code

The template verifies successful exploitation by executing commands (`echo` on Linux, `type` on Windows) and checking for their output in the response body.

## References

- https://blog.ripstech.com/2019/wordpress-image-remote-code-execution/
- http://packetstormsecurity.com/files/152396/WordPress-5.0.0-crop-image-Shell-Upload.html
- http://packetstormsecurity.com/files/161213/WordPress-5.0.0-Remote-Code-Execution.html
- http://www.rapid7.com/db/modules/exploit/multi/http/wp_crop_rce
- https://tryhackme.com/r/room/blog
