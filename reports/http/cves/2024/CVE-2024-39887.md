---
cve_id: CVE-2024-39887
template_path: nuclei-templates/http/cves/2024/CVE-2024-39887.yaml
affected_product: Apache Superset
severity: medium
authentication: required
external_callback: false
affected_versions: < 4.0.2
preconditions: [configured table datasource]
poc_classification: info-leak
---

## Vulnerability
Apache Superset versions prior to 4.0.2 contain an SQL Injection vulnerability due to improper neutralization of special elements used in SQL commands. Certain engine-specific functions are not checked, allowing authenticated attackers to bypass Superset's SQL authorization and execute restricted database queries. The fix introduces configuration key `DISALLOWED_SQL_FUNCTIONS` to block PostgreSQL functions such as `version`, `query_to_xml`, `inet_server_addr`, and `inet_client_addr`.  
CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N (score 4.3).

## PoC / Detection
Classification: info-leak

The template first executes a login sequence (GET `/login/` followed by POST `/login/` with CSRF token extraction and session cookie validation) using supplied `{{username}}`/`{{password}}`. It then sends POST `/api/v1/chart/data` (JSON payload, datasource id=1 type=table) containing `sqlExpression: "query_to_xml($$select convert_from(decode('{{base64(marker)}}', 'base64'),'utf8')$$,true,true,'')-- -"` to inject the restricted PostgreSQL function. Detection succeeds if status=200, content-type contains `application/json`, and response body contains the random marker inside `<convert_from>` tags, confirming successful bypass and in-band exfiltration of restricted query output.

## References
- https://blog.quarkslab.com/bypass-apache-superset-restrictions-to-perform-sql-injections.html
- http://www.openwall.com/lists/oss-security/2024/07/16/5
- https://lists.apache.org/thread/j55vm41jg3l0x6w49zrmvbf3k0ts5fqz
- https://nvd.nist.gov/vuln/detail/CVE-2024-39887
