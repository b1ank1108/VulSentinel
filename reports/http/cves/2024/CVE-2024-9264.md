---
cve_id: CVE-2024-9264
template_path: nuclei-templates/http/cves/2024/CVE-2024-9264.yaml
affected_product: Grafana
severity: critical
authentication: required
external_callback: false
affected_versions: unknown
preconditions: SQL Expressions experimental feature enabled and duckdb binary present in $PATH (not installed by default)
poc_classification: rce
---

## Vulnerability
Grafana Post-Auth DuckDB - SQL Injection To File Read (CVE-2024-9264)

The SQL Expressions experimental feature evaluates unsanitized `duckdb` queries containing user input. This produces command injection and local file inclusion. Any VIEWER-or-higher user can trigger the flaw provided the `duckdb` binary exists in Grafana's `$PATH`.

Impact: authenticated attackers read arbitrary local files and execute commands, exposing configuration and credentials.  
CVSS 3.1: 9.9 (AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H)  
CWE-94  
Remediation: apply vendor patch or upgrade.

## PoC / Detection
Classification: rce

The template first POSTs supplied credentials to `/login` and internally matches the returned `grafana_session` cookie. It then POSTs to `/api/ds/query?ds_type=__expr__&expression=true` using the Expression datasource with the payload  
`SELECT content FROM read_blob('/etc/passwd')`.  

Detection succeeds when the JSON response body contains both the regex `root:.*:0:` (file-read confirmation) and the literal `"data":{`.

## References
- https://x.com/nol_tech/status/1847639874909749443
- https://github.com/fkie-cad/nvd-json-data-feeds
- https://nvd.nist.gov/vuln/detail/CVE-2024-9264
