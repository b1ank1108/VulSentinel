---
cve_id: CVE-2023-48795
template_path: nuclei-templates/javascript/cves/2023/CVE-2023-48795.yaml
affected_product: OpenSSH
severity: medium
authentication: none
external_callback: false
affected_versions: OpenSSH before 9.6
preconditions: [supports chacha20-poly1305@openssh.com or CBC-EtM MACs, lacks kex-strict-s-v00@openssh.com]
poc_classification: detect-only
---

## Vulnerability
CVE-2023-48795 (Terrapin attack) affects the SSH Binary Packet Protocol implementation in OpenSSH before 9.6 (plus numerous other SSH products). Remote attackers can omit packets from the extension negotiation handshake, bypassing integrity checks and forcing downgrade or disablement of security features. The flaw is triggered specifically in chacha20-poly1305@openssh.com and (when CBC is negotiated) -etm@openssh.com MAC algorithms because sequence numbers and strict KEX handling are mishandled.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:H/A:N (score 5.9)  
CWE-354  
EPSS 0.57856 (98.13 percentile)  
CPE: cpe:2.3:a:openbsd:openssh:*:*:*:*:*:*:*:*

Impact: SSH connections using vulnerable algorithms lose integrity protection, enabling man-in-the-middle weakening.  
Remediation: Disable chacha20-poly1305@openssh.com and *-etm@openssh.com MACs; prefer AES-GCM.

## PoC / Detection
Classification: detect-only

The template opens a TCP connection to port 22, issues an SSH info-mode handshake via nuclei's SSHClient library, and inspects the ServerKex structure. It evaluates three helper functions: SupportsChaCha20 (checks ciphersClientServer/ciphersServerClient), SupportsCbcEtm (checks *-cbc ciphers paired with *-etm@openssh.com MACs), and SupportsStrictKex (looks for kex-strict-s-v00@openssh.com suffix). If (ChaCha20 or CbcEtm) is true and StrictKex is false the target is reported vulnerable. The check is fully passive and extracts only the KEX response string.

## References
- https://github.com/RUB-NDS/Terrapin-Scanner
- https://terrapin-attack.com/
- http://packetstormsecurity.com/files/176280/Terrapin-SSH-Connection-Weakening.html
- http://seclists.org/fulldisclosure/2024/Mar/21
- http://www.openwall.com/lists/oss-security/2023/12/18/3
