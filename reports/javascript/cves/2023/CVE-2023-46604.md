---
cve_id: CVE-2023-46604
template_path: nuclei-templates/javascript/cves/2023/CVE-2023-46604.yaml
affected_product: Apache ActiveMQ
severity: critical
authentication: none
external_callback: true
affected_versions: versions prior to 5.15.16, 5.16.7, 5.17.6, 5.18.3
preconditions: []
poc_classification: rce
---

## Vulnerability
Apache ActiveMQ suffers from unsafe deserialization of attacker-controlled class types in the OpenWire protocol (CWE-502). An unauthenticated remote attacker with network access to the broker can instantiate arbitrary classes present on the classpath, resulting in remote code execution and full broker compromise (CVSS 9.8). Fixed in 5.15.16 / 5.16.7 / 5.17.6 / 5.18.3.

## PoC / Detection
Classification: rce

The JavaScript template opens a raw TCP connection to the target on port 61616, constructs a crafted OpenWire packet embedding a Spring `beans` XML definition that declares a `java.lang.ProcessBuilder` bean executing `bash -c "curl http://<random>.<interactsh-domain>"`, and transmits the packet. Detection succeeds when an out-of-band DNS interaction matching the random subdomain is observed on the interactsh server, confirming the deserialization chain executed arbitrary shell commands.

## References
- http://www.openwall.com/lists/oss-security/2023/10/27/5
- https://activemq.apache.org/security-advisories.data/CVE-2023-46604-announcement.txt
- https://github.com/X1r0z/ActiveMQ-RCE
- https://attackerkb.com/topics/IHsgZDE3tS/cve-2023-46604/rapid7-analysis?referrer=etrblog
- https://paper.seebug.org/3058/
